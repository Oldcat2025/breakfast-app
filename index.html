<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™¨æ›¦é£Ÿå…‰ - å¥å®çš„å…ƒæ°”æ—©é¤</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- é…è‰²æ–¹æ¡ˆ (Morandi Green) --- */
        :root {
            --bg-deep: #051F20;
            --bg-main: #0B2B26;
            --card-dark: #163832;
            --card-mid: #235347;
            --accent-green: #8EB69B; 
            --accent-gold: #E09F3E;  
            --text-light: #DAF1DE;
            --text-white: #FFFFFF;
            --shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, var(--bg-deep) 0%, var(--bg-main) 100%);
            color: var(--text-light);
            margin: 0; padding: 0; min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 100px;
        }

        /* --- åŠ¨ç”» --- */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- é¡¶éƒ¨ Header --- */
        .header-container {
            background: var(--card-dark);
            padding: 20px 20px 30px;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            text-align: center;
        }
        .top-info-bar {
            display: inline-flex; gap: 8px; font-size: 0.8rem; color: var(--accent-green);
            background: rgba(0,0,0,0.3); padding: 6px 15px; border-radius: 20px;
            margin-bottom: 15px; align-items: center;
        }
        .info-divider { opacity: 0.4; }
        .greeting { font-size: 1.6rem; font-weight: bold; color: var(--text-white); margin: 10px 0; }
        .cycle-tip { font-size: 0.85rem; color: #888; }

        /* --- é€šç”¨æ ‡é¢˜ --- */
        .section-title {
            padding: 25px 20px 15px; font-size: 1.1rem; font-weight: bold; display: flex; align-items: center; color: var(--text-white);
        }
        .section-title::before {
            content: ''; display: block; width: 5px; height: 18px; background: var(--accent-green); margin-right: 12px; border-radius: 3px;
        }
        
        /* --- å­é¡µé¢å¤´ --- */
        .sub-header {
            background: var(--card-dark); padding: 15px 20px; display: flex; align-items: center; 
            justify-content: space-between; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        /* --- é¦–é¡µåˆ—è¡¨ (Vertical) --- */
        .recipe-list-vertical { display: flex; flex-direction: column; gap: 20px; padding: 0 20px; }
        .recipe-card-large {
            background: var(--card-mid); border-radius: 20px; overflow: hidden; box-shadow: var(--shadow);
            position: relative; transition: transform 0.2s;
        }
        .recipe-card-large:active { transform: scale(0.98); }
        .recipe-img-large { height: 190px; width: 100%; object-fit: cover; background-color: #2c3e50; }
        .recipe-info { padding: 15px 20px; }
        .recipe-name { font-size: 1.2rem; font-weight: bold; color: var(--text-white); margin-bottom: 6px; }
        .recipe-tags { display: flex; gap: 8px; margin-top: 8px; }
        .tag { font-size: 0.75rem; padding: 3px 8px; border-radius: 6px; background: rgba(0,0,0,0.3); color: var(--accent-green); }
        .time-badge {
            position: absolute; top: 15px; right: 15px; background: var(--accent-green); color: #051F20;
            padding: 4px 10px; border-radius: 10px; font-weight: bold; font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* --- æ›´å¤šåˆ—è¡¨ (Grid) --- */
        .recipe-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; }
        .grid-card { background: var(--card-mid); border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; height: 100%; }
        .grid-card img { width: 100%; height: 110px; object-fit: cover; background: #2c3e50; }
        .grid-card .info { padding: 10px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .grid-card .title { font-size: 0.9rem; font-weight: bold; color: var(--text-white); line-height: 1.3; }

        /* --- å¨ç¥æ¦œ --- */
        .leaderboard { margin: 20px; background: var(--card-dark); border-radius: 24px; padding: 20px; }
        .role-selector {
            display: flex; justify-content: center; gap: 25px; margin-bottom: 25px; 
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 25px;
        }
        .role-btn {
            width: 60px; height: 60px; border-radius: 50%; background: rgba(255,255,255,0.05); 
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            color: #888; transition: all 0.3s; cursor: pointer; border: 2px solid transparent;
        }
        .role-btn i { font-size: 1.5rem; margin-bottom: 0; }
        .role-btn.selected { 
            background: var(--card-mid); border-color: var(--accent-gold); color: var(--accent-gold); transform: scale(1.1); 
        }
        .rank-item { 
            display: flex; align-items: center; padding: 12px; margin-bottom: 10px; 
            background: rgba(255,255,255,0.05); border-radius: 12px; cursor: pointer;
        }
        .rank-icon-box { 
            width: 40px; height: 40px; border-radius: 50%; background: var(--card-mid); border: 1px solid var(--accent-green);
            display: flex; align-items: center; justify-content: center; color: white; margin-right: 12px;
        }
        .history-panel { display: none; background: rgba(0,0,0,0.2); padding: 10px; margin-bottom: 10px; border-radius: 8px; }
        .history-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .history-img { width: 100%; height: 70px; object-fit: cover; border-radius: 6px; }

        /* --- åº•éƒ¨å¯¼èˆª --- */
        .bottom-dock {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            background: rgba(22, 56, 50, 0.95); backdrop-filter: blur(12px);
            padding: 10px 30px; border-radius: 50px; display: flex; gap: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6); z-index: 900; border: 1px solid rgba(255,255,255,0.1);
        }
        .dock-btn { 
            display: flex; flex-direction: column; align-items: center; color: #888; cursor: pointer; width: 45px;
        }
        .dock-btn i { font-size: 1.3rem; margin-bottom: 3px; }
        .dock-btn span { font-size: 0.7rem; }
        .dock-btn.active { color: var(--accent-green); transform: translateY(-2px); }

        /* --- å¼¹çª— --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; overflow-y: auto; }
        .modal-content { background: #F4F1EA; color: #333; margin: 15px; border-radius: 20px; min-height: 85vh; padding-bottom: 40px; }
        .ing-grid { display: flex; gap: 15px; overflow-x: auto; padding: 10px 0; }
        .ing-item { text-align: center; min-width: 60px; }
        .ing-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; }
        
        /* å›¾ç‰‡åŠ è½½å¤±è´¥æ ·å¼ */
        .img-fallback {
            display: flex; align-items: center; justify-content: center; height: 100%; width: 100%;
            background: #2c3e50; color: #ecf0f1; font-size: 0.8rem; flex-direction: column;
        }
    </style>
</head>
<body>

    <div id="page-home" class="page active">
        <div class="header-container">
            <div class="top-info-bar">
                <span id="dateStr">12.11 å‘¨å››</span>
                <span class="info-divider">|</span>
                <span id="lunarStr">å†œå†å†¬æœˆ</span>
                <span class="info-divider">|</span>
                <span id="termStr">å¤§é›ª</span>
                <span class="info-divider">|</span>
                <span><i class="fas fa-sun"></i> æ™´</span>
            </div>
            <div class="greeting">æ—©å®‰ï¼Œå¥å®ï¼</div>
            <div class="cycle-tip">ğŸ“… 10å¤©ä¸é‡æ ·æ¨èï¼šç¬¬ <span id="cycleNum" style="color:var(--accent-gold); font-weight:bold;">1</span> å¤©</div>
        </div>

        <div class="section-title">ä»Šæ—¥æ¨èå…ƒæ°”æ—©é¤ï¼ˆ10åˆ†é’Ÿå¤‡å¦¥ï¼‰</div>
        <div class="recipe-list-vertical" id="homeList"></div>
    </div>

    <div id="page-more" class="page">
        <div class="sub-header">
            <span style="color:white; font-weight:bold;">âœ¨ æ›´å¤šèœè°± (æŒ‰æ¨èåº¦æ’åº)</span>
        </div>
        <div class="recipe-grid" id="moreList"></div>
    </div>

    <div id="page-rank" class="page">
        <div class="sub-header">
            <span style="color:white; font-weight:bold;">ğŸ† å®¶åº­å¨ç¥äº‰éœ¸èµ›</span>
        </div>
        <div class="leaderboard">
            <div class="role-selector">
                <div class="role-btn" onclick="setRole('mom')" id="r-mom">
                    <i class="fas fa-user-nurse"></i>
                    <span style="font-size:0.7rem;">å¦ˆå¦ˆ</span>
                </div>
                <div class="role-btn" onclick="setRole('dad')" id="r-dad">
                    <i class="fas fa-user-tie"></i>
                    <span style="font-size:0.7rem;">çˆ¸çˆ¸</span>
                </div>
                <div class="role-btn" onclick="setRole('kid')" id="r-kid">
                    <i class="fas fa-child"></i>
                    <span style="font-size:0.7rem;">å¥å®</span>
                </div>
            </div>
            <div id="rankList"></div>
            
            <div style="text-align:center; margin-top:20px;">
                <input type="file" id="upFile" accept="image/*" style="display:none;" onchange="doUpload(this)">
                <button id="upBtn" onclick="clkUpload()" style="width:100%; padding:15px; border-radius:15px; border:none; background:#444; color:#888; font-weight:bold;">
                    <i class="fas fa-camera"></i> è¯·å…ˆé€‰æ‹©è§’è‰²
                </button>
            </div>
        </div>
    </div>

    <div class="bottom-dock">
        <div class="dock-btn active" onclick="goPage('page-home')" id="nav-home">
            <i class="fas fa-home"></i><span>é¦–é¡µ</span>
        </div>
        <div class="dock-btn" onclick="goPage('page-more')" id="nav-more">
            <i class="fas fa-th-large"></i><span>æ›´å¤š</span>
        </div>
        <div class="dock-btn" onclick="goPage('page-rank')" id="nav-rank">
            <i class="fas fa-trophy"></i><span>å¨ç¥æ¦œ</span>
        </div>
    </div>

    <div id="modal" class="modal">
        <div style="position:fixed; top:20px; left:20px; z-index:1002;">
            <button onclick="closeModal()" style="background:rgba(0,0,0,0.6); border:none; color:white; padding:8px 15px; border-radius:20px;">
                <i class="fas fa-arrow-left"></i> å…³é—­
            </button>
        </div>
        <div id="modalBody" class="modal-content"></div>
    </div>

    <script>
        // --- æ ¸å¿ƒæ•°æ®åº“ï¼šäººå·¥ç­›é€‰ Top 20 ---
        // æ’åºè§„åˆ™ï¼šå‰ 10 ä¸ªæ˜¯ç»è¿‡å›¾ç‰‡éªŒè¯ã€ç»å¯¹èƒ½æ˜¾ç¤ºçš„â€œé‡‘ç‰Œèœè°±â€ã€‚
        // è¯·å‹¿éšæ„æ‰“ä¹±é¡ºåºï¼Œä»¥ä¿è¯é¦–é¡µæ¨èçš„è´¨é‡ã€‚
        const DB = [
            // No.1 è›‹ç…åå¸ (å›¾ç‰‡æç¨³)
            {
                title: "é»„é‡‘è›‹ç…åå¸", time: "5 min", tags: ["å‰©é¥­ç¥å™¨","é¦™è½¯"],
                img: "https://images.unsplash.com/photo-1484723091739-30a097e8f929?auto=format&fit=crop&w=800&q=80",
                desc: "å‰©åå¸è£¹æ»¡è›‹æ¶²ç…è‡³é‡‘é»„ï¼Œå¥¶é¦™æµ“éƒã€‚",
                ings: [{n:"åå¸",i:""},{n:"é¸¡è›‹",i:""},{n:"ç‰›å¥¶",i:""}]
            },
            // No.2 è‘±æ²¹æ‹Œé¢ (å›¾ç‰‡ç¨³ï¼Œé¢æ¡å›¾é€šç”¨)
            {
                title: "å¿«æ‰‹è‘±æ²¹æ‹Œé¢", time: "8 min", tags: ["å¼€èƒƒ","èƒ½é‡"],
                img: "https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?auto=format&fit=crop&w=800&q=80",
                desc: "ä¸€æŠŠæŒ‚é¢ç…®ç†Ÿï¼Œæ·‹ä¸Šé…±æ²¹é¦™æ²¹é†‹ï¼Œæ’’ä¸Šè‘±èŠ±ã€‚",
                ings: [{n:"æŒ‚é¢",i:""},{n:"å°è‘±",i:""},{n:"é…±æ²¹",i:""}]
            },
            // No.3 åšæœç‰›å¥¶ç‡•éº¦ (ä¿®æ­£ï¼šæ¢æˆæ›´åƒç²¥çš„å›¾)
            {
                title: "åšæœç‰›å¥¶ç‡•éº¦ç²¥", time: "5 min", tags: ["è¡¥è„‘","é’™"],
                img: "https://images.unsplash.com/photo-1505253716371-bab3a29d6d09?auto=format&fit=crop&w=800&q=80",
                desc: "ç‡•éº¦ç‰‡åŠ ç‰›å¥¶ç…®çƒ­ï¼Œæ’’ä¸Šä¸€æŠŠæ¯æ—¥åšæœã€‚",
                ings: [{n:"ç‡•éº¦",i:""},{n:"ç‰›å¥¶",i:""},{n:"åšæœ",i:""}]
            },
            // No.4 é²œè‚‰äº‘å/é¥ºå­ (ä¿®æ­£ï¼šæ¢æˆæ±¤é¥ºå›¾)
            {
                title: "ç´«èœè™¾çš®å°äº‘å", time: "8 min", tags: ["æ±¤æ°´","æš–èƒƒ"],
                img: "https://images.unsplash.com/photo-1596797038530-2c107229654b?auto=format&fit=crop&w=800&q=80",
                desc: "å®¶ä¸­å¸¸å¤‡é€Ÿå†»å°äº‘åï¼Œæ±¤åº•åŠ ç´«èœè™¾çš®ã€‚",
                ings: [{n:"äº‘å",i:""},{n:"ç´«èœ",i:""},{n:"è™¾çš®",i:""}]
            },
            // No.5 é¸¡è›‹ä¸‰æ˜æ²»
            {
                title: "æ»‘è›‹ç«è…¿ä¸‰æ˜æ²»", time: "5 min", tags: ["é«˜è›‹ç™½","å¿«æ‰‹"],
                img: "https://images.unsplash.com/photo-1525351484163-7529414395d8?auto=format&fit=crop&w=800&q=80",
                desc: "é¸¡è›‹ç‚’å«©ï¼Œå¤¹åœ¨ä¸¤ç‰‡åå¸ä¸­é—´ã€‚",
                ings: [{n:"åå¸",i:""},{n:"é¸¡è›‹",i:""},{n:"ç«è…¿",i:""}]
            },
            // No.6 å¹¿å¼è’¸æ°´è›‹ (æ›¿æ¢è‚ ç²‰ï¼Œå›¾ç¨³åšæ³•ç®€å•)
            {
                title: "å¹¿å¼è’¸æ°´è›‹", time: "10 min", tags: ["å«©æ»‘","å¥½å¸æ”¶"],
                img: "https://images.unsplash.com/photo-1512443048503-45607db35378?auto=format&fit=crop&w=800&q=80",
                desc: "é¸¡è›‹åŠ æ¸©æ°´æ‰“åŒ€ï¼Œè’¸10åˆ†é’Ÿæ·‹é…±æ²¹ï¼Œåƒå¸ƒä¸ä¸€æ ·å«©ã€‚",
                ings: [{n:"é¸¡è›‹",i:""},{n:"æ¸©æ°´",i:""},{n:"é…±æ²¹",i:""}]
            },
            // No.7 è“è“å±±è¯ (ä¿®æ­£ï¼šæ‰¾äº†ç´«è‰²çš„å›¾)
            {
                title: "è“è“å±±è¯æ³¥", time: "10 min", tags: ["å¥è„¾","ç”œç‚¹"],
                img: "https://images.unsplash.com/photo-1550523024-65939765876e?auto=format&fit=crop&w=800&q=80", 
                desc: "é“æ£å±±è¯è’¸ç†Ÿå‹æ³¥ï¼Œæ·‹ä¸Šè“è“é…±ã€‚",
                ings: [{n:"å±±è¯",i:""},{n:"è“è“é…±",i:""}]
            },
            // No.8 è™¾ä»æ»‘è›‹ (ä¿®æ­£ï¼šæ¢æˆç‚’è›‹å›¾)
            {
                title: "è™¾ä»è¥¿å…°èŠ±æ»‘è›‹", time: "8 min", tags: ["ä½è„‚","æŠ¤çœ¼"],
                img: "https://images.unsplash.com/photo-1627308595229-7830a5c91f9f?auto=format&fit=crop&w=800&q=80", 
                desc: "è™¾ä»å’Œè¥¿å…°èŠ±ç„¯æ°´ï¼Œæ·‹å…¥è›‹æ¶²ç‚’ç†Ÿã€‚",
                ings: [{n:"è™¾ä»",i:""},{n:"è¥¿å…°èŠ±",i:""},{n:"é¸¡è›‹",i:""}]
            },
            // No.9 ç‰›æ²¹æœæ‹Œé¥­/åå¸
            {
                title: "ç‰›æ²¹æœæºå¿ƒè›‹", time: "5 min", tags: ["ä¼˜è´¨æ²¹","è„‘åŠ›"],
                img: "https://images.unsplash.com/photo-1550953831-295058f967f6?auto=format&fit=crop&w=800&q=80",
                desc: "åŠä¸ªç‰›æ²¹æœåˆ‡ç‰‡ï¼Œé…ä¸€ä¸ªç…è›‹ã€‚",
                ings: [{n:"ç‰›æ²¹æœ",i:""},{n:"é¸¡è›‹",i:""}]
            },
            // No.10 é¸¡è‚‰å·
            {
                title: "ç”Ÿèœé¸¡è‚‰å·", time: "8 min", tags: ["ä¾¿æº","å‡è„‚"],
                img: "https://images.unsplash.com/photo-1626700051175-6818013e1d4f?auto=format&fit=crop&w=800&q=80",
                desc: "å·é¥¼çš®åŠ çƒ­ï¼Œå·å…¥ç”Ÿèœå’Œç†Ÿé¸¡èƒ¸è‚‰ã€‚",
                ings: [{n:"å·é¥¼",i:""},{n:"é¸¡è‚‰",i:""},{n:"ç”Ÿèœ",i:""}]
            },
            // --- åç»­è¡¥å……èœè°± ---
            { title: "é…¸å¥¶æ°´æœç¢—", time: "3 min", tags: ["ç»´C"], img: "https://images.unsplash.com/photo-1488477181946-6428a0291777?auto=format&fit=crop&w=600", desc:"é…¸å¥¶æ‹Œæ°´æœã€‚", ings:[{n:"é…¸å¥¶",i:""},{n:"æ°´æœ",i:""}] },
            { title: "ç…®çº¢è–¯é¸¡è›‹", time: "10 min", tags: ["æç®€"], img: "https://images.unsplash.com/photo-1594970420448-6932a93361e6?auto=format&fit=crop&w=600", desc:"ä¸€é”…è’¸ç†Ÿã€‚", ings:[{n:"çº¢è–¯",i:""},{n:"é¸¡è›‹",i:""}] },
            { title: "å¿«æ‰‹è›‹ç‚’é¥­", time: "8 min", tags: ["ç®¡é¥±"], img: "https://images.unsplash.com/photo-1603133872878-684f208fb84b?auto=format&fit=crop&w=600", desc:"å‰©ç±³é¥­ç‚’è›‹ã€‚", ings:[{n:"ç±³é¥­",i:""},{n:"é¸¡è›‹",i:""}] },
            { title: "ç‰›å¥¶ç‰ç±³ç‰‡", time: "2 min", tags: ["æé€Ÿ"], img: "https://images.unsplash.com/photo-1520025642999-566275e5262c?auto=format&fit=crop&w=600", desc:"å³é£Ÿè°·ç‰©ã€‚", ings:[{n:"ç‰ç±³ç‰‡",i:""},{n:"ç‰›å¥¶",i:""}] },
            { title: "é‡‘æªé±¼é¥­å›¢", time: "8 min", tags: ["DHA"], img: "https://images.unsplash.com/photo-1563102325-1a3b37905d49?auto=format&fit=crop&w=600", desc:"ç±³é¥­æ‹Œç½å¤´é±¼ã€‚", ings:[{n:"ç±³é¥­",i:""},{n:"é‡‘æªé±¼",i:""}] }
        ];

        // ç»Ÿä¸€é£Ÿæå›¾ (å…œåº•)
        const COMMON_ING_IMG = "https://images.unsplash.com/photo-1606914469725-e39c34bfdebe?auto=format&fit=crop&w=100&q=80";
        DB.forEach(r => {
            r.ings.forEach(i => { if(!i.i) i.i = COMMON_ING_IMG; });
            if(!r.steps) r.steps = ["1. å‡†å¤‡é£Ÿææ¸…æ´—å¹²å‡€","2. ç®€å•çƒ¹é¥ªåŠ çƒ­","3. è£…ç›˜äº«ç”¨"];
        });

        // --- åˆå§‹åŒ–æ—¥æœŸ ---
        const now = new Date();
        const days = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
        document.getElementById('dateStr').innerText = `${now.getMonth()+1}.${now.getDate()} å‘¨${days[now.getDay()]}`;
        
        // ç®€å•è®¡ç®—å¾ªç¯å¤©æ•° (1-10)
        const start = new Date(now.getFullYear(), 0, 0);
        const dayOfYear = Math.floor((now - start) / 1000 / 60 / 60 / 24);
        const cycle = (dayOfYear % 10) + 1;
        document.getElementById('cycleNum').innerText = cycle;

        // --- æ¸²æŸ“é€»è¾‘ ---
        // é¦–é¡µï¼šå¼ºåˆ¶å–å‰3ä¸ª (ç¡®ä¿å›¾ç‰‡ç»å¯¹æ²¡é—®é¢˜) + æ ¹æ®æ—¥æœŸè½®æ’­åç§»
        // ä¸ºäº†ç¡®ä¿å›¾ç‰‡å¥½ï¼Œæˆ‘ä»¬åªåœ¨ Top 10 é‡Œè½®æ’­
        const top10 = DB.slice(0, 10);
        const offset = (cycle - 1) % (top10.length - 2); // ç®€å•ä½ç§»
        // å®é™…ä¸Šä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œæˆ‘ä»¬ä»Šå¤©ç›´æ¥æ˜¾ç¤ºå‰3ä¸ªï¼Œä½ å¯ä»¥æ”¹æˆ offset
        const homeList = document.getElementById('homeList');
        
        // *å…³é”®ä¿®æ­£*ï¼šå§‹ç»ˆæ˜¾ç¤º DB é‡Œçš„å‰ 3 ä¸ªä½œä¸ºé¦–é¡µæ¨èï¼Œç¡®ä¿å›¾ç‰‡æœ€ç¨³
        // å¦‚æœæƒ³è¦è½®æ’­ï¼Œå¯ä»¥ä½¿ç”¨ï¼š const todayIdx = [0,1,2].map(i => (i + cycle) % 10);
        const todayIdx = [0, 1, 2]; 

        todayIdx.forEach(idx => {
            const r = DB[idx];
            homeList.innerHTML += `
                <div class="recipe-card-large" onclick="openRecipe(${idx})">
                    <div class="time-badge">${r.time}</div>
                    <img src="${r.img}" class="recipe-img-large" onerror="this.src='${COMMON_ING_IMG}'">
                    <div class="recipe-info">
                        <div class="recipe-name">${r.title}</div>
                        <div style="font-size:0.9rem; color:#ccc;">${r.desc}</div>
                        <div class="recipe-tags">
                            ${r.tags.map(t=>`<span class="tag">${t}</span>`).join('')}
                        </div>
                    </div>
                </div>`;
        });

        // æ›´å¤šé¡µï¼šæ˜¾ç¤ºå…¨éƒ¨
        const moreList = document.getElementById('moreList');
        DB.forEach((r, idx) => {
            moreList.innerHTML += `
                <div class="grid-card" onclick="openRecipe(${idx})">
                    <img src="${r.img}" onerror="this.src='${COMMON_ING_IMG}'">
                    <div class="info">
                        <div class="title">${r.title}</div>
                        <div style="font-size:0.8rem; color:var(--accent-green); margin-top:5px;">${r.time}</div>
                    </div>
                </div>`;
        });

        // --- äº¤äº’é€»è¾‘ ---
        function goPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
            document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active'));
            if(id.includes('home')) document.getElementById('nav-home').classList.add('active');
            if(id.includes('more')) document.getElementById('nav-more').classList.add('active');
            if(id.includes('rank')) document.getElementById('nav-rank').classList.add('active');
        }

        function openRecipe(idx) {
            const r = DB[idx];
            const html = `
                <img src="${r.img}" style="width:100%; height:260px; object-fit:cover;">
                <div style="padding:20px;">
                    <h2 style="color:#235347; margin-top:0;">${r.title}</h2>
                    <p style="background:rgba(142,182,155,0.2); padding:10px; border-radius:8px;">${r.desc}</p>
                    <h4 style="border-left:4px solid #235347; padding-left:10px;">é£Ÿæ</h4>
                    <div class="ing-grid">
                        ${r.ings.map(i => `
                            <div class="ing-item">
                                <img src="${i.i}" class="ing-img">
                                <div style="font-size:0.8rem; margin-top:5px;">${i.n}</div>
                            </div>`).join('')}
                    </div>
                    <h4 style="border-left:4px solid #235347; padding-left:10px;">ç®€æ˜“åšæ³•</h4>
                    ${r.steps.map(s=>`<div style="padding:8px 0; border-bottom:1px dashed #ccc;">${s}</div>`).join('')}
                    <div style="height:60px;"></div>
                </div>`;
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('modal').style.display = 'block';
        }
        function closeModal(){ document.getElementById('modal').style.display = 'none'; }

        // --- å¨ç¥æ¦œ ---
        let curRole = null;
        let users = JSON.parse(localStorage.getItem('bf_users')) || [
            {id:'mom', n:'å¦ˆå¦ˆ', s:5, h:[]},
            {id:'dad', n:'çˆ¸çˆ¸', s:2, h:[]},
            {id:'kid', n:'å¥å®', s:3, h:[]}
        ];

        function renderRank() {
            const list = document.getElementById('rankList');
            list.innerHTML = '';
            users.sort((a,b)=>b.s - a.s).forEach((u, i) => {
                let hHtml = u.h.length ? `<div class="history-grid">${u.h.map(src=>`<img src="${src}" class="history-img">`).join('')}</div>` : '<div style="color:#666; font-size:0.8rem; text-align:center;">æš‚æ— è®°å½•</div>';
                list.innerHTML += `
                    <div style="background:rgba(255,255,255,0.05); border-radius:12px; margin-bottom:10px; overflow:hidden;">
                        <div class="rank-item" onclick="toggleHist(this)">
                            <div class="rank-icon-box" style="background:${i==0?'var(--accent-gold)':'var(--card-mid)'}">${i+1}</div>
                            <div style="flex:1; color:white;">
                                <div style="font-weight:bold;">${u.n} ${i==0?'ğŸ‘‘':''}</div>
                                <div style="font-size:0.8rem; color:var(--accent-green);">ç§¯åˆ†: ${u.s}</div>
                            </div>
                            <i class="fas fa-chevron-down" style="color:#666;"></i>
                        </div>
                        <div class="history-panel">${hHtml}</div>
                    </div>`;
            });
        }

        function setRole(id) {
            curRole = id;
            document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('r-'+id).classList.add('selected');
            const u = users.find(u=>u.id==id);
            const btn = document.getElementById('upBtn');
            btn.innerHTML = `<i class="fas fa-camera"></i> ${u.n}åšå¥½å•¦ï¼ç‚¹å‡»ä¸Šä¼ `;
            btn.style.background = 'var(--accent-gold)';
            btn.style.color = '#051F20';
        }
        function clkUpload(){ if(curRole) document.getElementById('upFile').click(); }
        function doUpload(el) {
            if(el.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    const u = users.find(u=>u.id==curRole);
                    u.s++; u.h.unshift(e.target.result);
                    localStorage.setItem('bf_users', JSON.stringify(users));
                    alert('ä¸Šä¼ æˆåŠŸï¼ç§¯åˆ†+1');
                    renderRank();
                };
                reader.readAsDataURL(el.files[0]);
            }
        }
        function toggleHist(el) {
            const p = el.nextElementSibling;
            p.style.display = p.style.display==='block'?'none':'block';
        }

        renderRank();
    </script>
</body>
</html>
