<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™¨æ›¦é£Ÿå…‰ - å¥å®çš„å…ƒæ°”æ—©é¤</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- æ ¸å¿ƒé…è‰² (Morandi Green System) --- */
        :root {
            --bg-deep: #051F20;
            --bg-main: #0B2B26;
            --card-dark: #163832;
            --card-mid: #235347;
            --accent-green: #8EB69B; /* è«å…°è¿ªç»¿ */
            --accent-gold: #E09F3E;  /* è«å…°è¿ªé‡‘ (å¼ºè°ƒè‰²) */
            --text-light: #DAF1DE;
            --text-white: #FFFFFF;
            --shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, var(--bg-deep) 0%, var(--bg-main) 100%);
            color: var(--text-light);
            margin: 0; padding: 0; min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 100px; /* åº•éƒ¨å¯¼èˆªç•™ç™½ */
        }

        /* --- é¡µé¢åˆ‡æ¢åŠ¨ç”» --- */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 1. é¡¶éƒ¨ä¿¡æ¯æ  (Header) --- */
        .header-container {
            background: var(--card-dark);
            padding: 20px;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
        }
        /* é¡¶éƒ¨æ•°æ®æ¡ */
        .top-info-bar {
            display: inline-flex;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--accent-green);
            background: rgba(0,0,0,0.3);
            padding: 6px 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            align-items: center;
        }
        .info-divider { opacity: 0.4; }
        
        .date-main { font-size: 1.1rem; color: #fff; font-weight: bold; margin-bottom: 5px; letter-spacing: 1px; }
        .greeting { font-size: 1.6rem; font-weight: bold; color: var(--text-white); margin: 10px 0; }
        .cycle-tip { font-size: 0.85rem; color: #888; margin-top: 5px; }

        /* --- 2. é€šç”¨ç»„ä»¶ --- */
        .section-title {
            padding: 25px 20px 15px; font-size: 1.1rem; font-weight: bold; display: flex; align-items: center; color: var(--text-white);
        }
        .section-title::before {
            content: ''; display: block; width: 5px; height: 18px; background: var(--accent-green); margin-right: 12px; border-radius: 3px;
        }
        
        .sub-header {
            background: var(--card-dark); padding: 15px 20px; display: flex; align-items: center; 
            justify-content: space-between; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .nav-btn {
            background: rgba(255,255,255,0.1); border: none; color: var(--text-white); padding: 8px 15px;
            border-radius: 20px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 5px;
        }

        /* --- 3. é£Ÿè°±å¡ç‰‡æ ·å¼ --- */
        .recipe-list-vertical { display: flex; flex-direction: column; gap: 25px; padding: 0 20px; }
        .recipe-card-large {
            background: var(--card-mid); border-radius: 24px; overflow: hidden; box-shadow: var(--shadow);
            position: relative; transition: transform 0.2s;
        }
        .recipe-card-large:active { transform: scale(0.98); }
        .recipe-img-large { height: 200px; width: 100%; object-fit: cover; background-color: #2c3e50; }
        .recipe-info { padding: 20px; }
        .recipe-name { font-size: 1.2rem; font-weight: bold; color: var(--text-white); margin-bottom: 8px; }
        
        /* æ ‡ç­¾ */
        .recipe-tags { display: flex; gap: 8px; margin-top: 8px; }
        .tag { font-size: 0.75rem; padding: 3px 8px; border-radius: 6px; background: rgba(0,0,0,0.3); color: var(--accent-green); }
        
        /* æ—¶é—´è§’æ ‡ */
        .time-badge {
            position: absolute; top: 15px; right: 15px; background: var(--accent-green); color: #051F20;
            padding: 5px 12px; border-radius: 12px; font-weight: bold; font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* ç½‘æ ¼å¸ƒå±€ */
        .recipe-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .grid-card { background: var(--card-mid); border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; height: 100%; }
        .grid-card img { width: 100%; height: 120px; object-fit: cover; background: #2c3e50; }
        .grid-card .info { padding: 10px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .grid-card .title { font-size: 0.9rem; font-weight: bold; color: var(--text-white); line-height: 1.3; }

        /* --- 4. å¨ç¥æ¦œ (æ ·å¼å‡çº§ï¼šå›¾æ ‡åŒ–) --- */
        .leaderboard { margin: 20px; background: var(--card-dark); border-radius: 24px; padding: 20px; }
        
        /* è§’è‰²é€‰æ‹©å™¨ - å›¾æ ‡é£æ ¼ */
        .role-selector {
            display: flex; justify-content: center; gap: 25px; margin-bottom: 25px; 
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 25px;
        }
        .role-btn {
            width: 65px; height: 65px; border-radius: 50%; 
            background: rgba(255,255,255,0.05); /* é»˜è®¤æ·¡è‰²èƒŒæ™¯ */
            border: 2px solid transparent;
            display: flex; align-items: center; justify-content: center; 
            font-size: 1.8rem; color: #888; /* é»˜è®¤ç°è‰² */
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer; position: relative;
        }
        /* é€‰ä¸­/æ¿€æ´»çŠ¶æ€ */
        .role-btn.selected { 
            background: var(--card-mid); 
            border-color: var(--accent-gold); 
            color: var(--accent-gold); 
            transform: scale(1.15); 
            box-shadow: 0 0 15px rgba(224, 159, 62, 0.3);
        }
        .role-label {
            position: absolute; bottom: -25px; font-size: 0.8rem; color: #aaa; width: 100px; text-align: center;
        }
        .role-btn.selected .role-label { color: var(--accent-gold); font-weight: bold; }
        
        /* æ’è¡Œåˆ—è¡¨ - å›¾æ ‡å¤´åƒ */
        .rank-item-wrapper { margin-bottom: 15px; background: rgba(255,255,255,0.05); border-radius: 15px; overflow: hidden; }
        .rank-item { display: flex; align-items: center; padding: 15px; cursor: pointer; }
        .rank-icon-box { 
            width: 45px; height: 45px; border-radius: 50%; 
            background: var(--card-mid); border: 1px solid var(--accent-green);
            display: flex; align-items: center; justify-content: center; 
            color: var(--text-white); font-size: 1.2rem; margin-right: 15px; 
        }
        .rank-arrow { margin-left: auto; color: #666; transition: transform 0.3s; }
        .rank-item.open .rank-arrow { transform: rotate(180deg); color: var(--accent-green); }

        /* å†å²è®°å½• */
        .history-panel { display: none; background: rgba(0,0,0,0.2); padding: 15px; border-top: 1px solid rgba(255,255,255,0.05); }
        .history-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .history-img { width: 100%; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); }

        /* ä¸Šä¼ æŒ‰é’® */
        .upload-section { margin-top: 20px; text-align: center; }
        .upload-btn {
            width: 100%; padding: 16px; background: #444; color: #888; border: none; border-radius: 16px;
            font-weight: bold; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px;
            pointer-events: none; transition: all 0.3s;
        }
        .upload-btn.active { 
            background: var(--accent-gold); color: #051F20; pointer-events: auto; 
            box-shadow: 0 5px 20px rgba(224, 159, 62, 0.4); 
        }

        /* --- 5. åº•éƒ¨æ‚¬æµ®å¯¼èˆª (ä¸€è‡´æ€§ä¼˜åŒ–) --- */
        .bottom-dock {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            background: rgba(22, 56, 50, 0.95); backdrop-filter: blur(12px);
            padding: 12px 30px; border-radius: 50px; display: flex; 
            gap: 50px; /* å¢åŠ é—´è· */
            box-shadow: 0 10px 30px rgba(0,0,0,0.6); z-index: 900; 
            border: 1px solid rgba(255,255,255,0.1);
            align-items: center; justify-content: center;
        }
        .dock-btn { 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #888; cursor: pointer; transition: all 0.2s; width: 40px;
        }
        .dock-btn i { font-size: 1.4rem; margin-bottom: 4px; }
        .dock-btn span { font-size: 0.75rem; font-weight: 500; }
        
        /* æ¿€æ´»çŠ¶æ€ */
        .dock-btn.active { color: var(--accent-green); transform: translateY(-2px); }
        .dock-btn.active i { color: var(--accent-green); text-shadow: 0 0 10px rgba(142, 182, 155, 0.4); }

        /* --- 6. è¯¦æƒ…å¼¹çª— --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; overflow-y: auto; }
        .modal-content { background: #F4F1EA; color: #333; margin: 15px; border-radius: 20px; min-height: 85vh; padding-bottom: 40px; }
        .ingredients-box { background: #fff; margin: 15px; padding: 15px; border-radius: 12px; }
        .ing-grid { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 5px;}
        .ing-item { text-align: center; min-width: 60px; }
        .ing-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; }

        /* å›¾ç‰‡é”™è¯¯æç¤º */
        .img-error { display: flex; align-items: center; justify-content: center; background: #333; color: #fff; height: 100%; font-size: 0.8rem; flex-direction: column; }
    </style>
</head>
<body>

    <div id="page-home" class="page active">
        <div class="header-container">
            <div class="top-info-bar">
                <span id="gregorianDate">12.11 å‘¨å››</span>
                <span class="info-divider">|</span>
                <span id="lunarText">å†œå†</span>
                <span class="info-divider">|</span>
                <span id="solarTerm">èŠ‚æ°”</span>
                <span class="info-divider">|</span>
                <span id="weatherText"><i class="fas fa-cloud-sun"></i> æ™´ 12Â°C</span>
            </div>
            
            <div class="greeting">æ—©å®‰ï¼Œå¥å®ï¼</div>
            <div class="cycle-tip">âœ¨ 10å¤©ä¸é‡æ ·æ¨èï¼šç¬¬ <span id="cycleDay" style="color:var(--accent-gold); font-weight:bold;">1</span> å¤©</div>
        </div>

        <div class="section-title">ä»Šæ—¥æ¨èå…ƒæ°”æ—©é¤ï¼ˆ10åˆ†é’Ÿå¤‡å¦¥ï¼‰</div>
        <div class="recipe-list-vertical" id="homeRecipeList"></div>
        <div style="height: 40px;"></div>
    </div>

    <div id="page-more" class="page">
        <div class="sub-header">
            <span style="color:white; font-weight:bold; font-size:1.1rem;">30å¤©ç¾å‘³èœè°±åº“</span>
        </div>
        <div class="recipe-grid" id="moreRecipeGrid"></div>
    </div>

    <div id="page-rank" class="page">
        <div class="sub-header">
            <span style="color:white; font-weight:bold; font-size:1.1rem;">å®¶åº­å¨ç¥äº‰éœ¸èµ›</span>
        </div>

        <div class="leaderboard">
            <div style="text-align:center; color:#ccc; margin-bottom:20px; font-size:0.9rem;">
                <i class="fas fa-info-circle"></i> ç¬¬ä¸€æ­¥ï¼šè¯·ç‚¹å‡»ä¸‹æ–¹å›¾æ ‡é€‰æ‹©èº«ä»½
            </div>
            
            <div class="role-selector">
                <div class="role-btn" onclick="selectRole('mom')" id="btn-mom">
                    <i class="fas fa-user-nurse"></i> <div class="role-label">å¦ˆå¦ˆ</div>
                </div>
                <div class="role-btn" onclick="selectRole('dad')" id="btn-dad">
                    <i class="fas fa-user-tie"></i> <div class="role-label">çˆ¸çˆ¸</div>
                </div>
                <div class="role-btn" onclick="selectRole('kid')" id="btn-kid">
                    <i class="fas fa-child"></i> <div class="role-label">å¥å®</div>
                </div>
            </div>

            <div id="rankingList"></div>

            <div class="upload-section">
                <input type="file" id="uploadInput" accept="image/*" style="display: none;" onchange="handleUpload(this)">
                <button id="mainUploadBtn" class="upload-btn" onclick="triggerUpload()">
                    <i class="fas fa-camera"></i> è¯·å…ˆé€‰æ‹©è§’è‰²
                </button>
            </div>
        </div>
    </div>

    <div class="bottom-dock">
        <div class="dock-btn active" onclick="showPage('page-home')" id="nav-home">
            <i class="fas fa-home"></i>
            <span>é¦–é¡µ</span>
        </div>
        <div class="dock-btn" onclick="showPage('page-more')" id="nav-more">
            <i class="fas fa-utensils"></i>
            <span>æ›´å¤š</span>
        </div>
        <div class="dock-btn" onclick="showPage('page-rank')" id="nav-rank">
            <i class="fas fa-trophy"></i>
            <span>å¨ç¥æ¦œ</span>
        </div>
    </div>

    <div id="recipeModal" class="modal">
        <div style="position:absolute; top:20px; left:20px; z-index:1002;">
            <button class="nav-btn" style="background:rgba(0,0,0,0.6);" onclick="closeModal()">
                <i class="fas fa-arrow-left"></i> å…³é—­
            </button>
        </div>
        <div class="modal-content" id="modalContent"></div>
    </div>

    <script>
        // ================= 1. ä¿®å¤åçš„å›¾ç‰‡æ•°æ®åº“ (æ— éœ€ç™»å½•çš„ç›´è¿å›¾) =================
        // ä½¿ç”¨ Unsplash Public IDï¼Œç¡®ä¿æ— éœ€ç™»å½•å³å¯æŸ¥çœ‹ã€‚
        // åŸæ–™å›¾ç‰‡ä½¿ç”¨é€šç”¨é£Ÿæå›¾
        const IMG_BASE = "https://images.unsplash.com/photo-";
        const IMG_PARAMS = "?auto=format&fit=crop&w=600&q=80"; // ä¼˜åŒ–åŠ è½½å‚æ•°

        const RECIPE_DB = [
            // --- Day 1 ---
            { 
                title: "åšæœç‰›å¥¶ç‡•éº¦ç²¥", time: "5 min", tags: ["è¡¥è„‘"], 
                img: IMG_BASE + "1517601278517-456741619dad" + IMG_PARAMS, 
                desc: "ç‡•éº¦å¯Œå«è†³é£Ÿçº¤ç»´ï¼Œç‰›å¥¶æä¾›é’™è´¨ã€‚", 
                ingredients: [{name:"ç‡•éº¦",img:IMG_BASE+"1586201375761-83865001e31c"+IMG_PARAMS},{name:"ç‰›å¥¶",img:IMG_BASE+"1550583724-b2692b85b150"+IMG_PARAMS}] 
            },
            { 
                title: "æ»‘è›‹ç‰›è‚‰å…¨éº¦å·", time: "8 min", tags: ["é•¿é«˜"], 
                img: IMG_BASE + "1626700051175-6818013e1d4f" + IMG_PARAMS, 
                desc: "ç‰›è‚‰è¡¥é“ï¼Œå…¨éº¦æŠ—é¥¿ã€‚", 
                ingredients: [{name:"å…¨éº¦é¥¼",img:IMG_BASE+"1565299624946-b28f40a0ae38"+IMG_PARAMS},{name:"ç‰›è‚‰",img:IMG_BASE+"1613476364124-748981c20e28"+IMG_PARAMS}] 
            },
            { 
                title: "è™¾ä»è¥¿å…°èŠ±çƒ˜è›‹", time: "10 min", tags: ["æŠ¤çœ¼"], 
                img: IMG_BASE + "1587486913049-53fc88980cfc" + IMG_PARAMS, 
                desc: "è‰²å½©ä¸°å¯Œï¼Œä½è„‚é«˜è›‹ç™½ã€‚", 
                ingredients: [{name:"è™¾ä»",img:IMG_BASE+"1565680018434-b513d5e5fd47"+IMG_PARAMS},{name:"è¥¿å…°èŠ±",img:IMG_BASE+"1459411621453-7eddff3f5f6c"+IMG_PARAMS}] 
            },
            
            // --- Day 2 ---
            { title: "é‡‘æªé±¼ç‰ç±³ä¸‰æ˜æ²»", time: "5 min", tags: ["ç›Šæ™º"], img: IMG_BASE + "1525351484163-7529414395d8" + IMG_PARAMS, desc: "é‡‘æªé±¼å¯Œå«DHAã€‚", ingredients: [{name:"åå¸",img:""},{name:"é‡‘æªé±¼",img:""}] },
            { title: "è‘±æ²¹é˜³æ˜¥é¢", time: "8 min", tags: ["æš–èƒƒ"], img: IMG_BASE + "1612929633738-8fe44f7ec841" + IMG_PARAMS, desc: "æš–å¿ƒæ±¤é¢ã€‚", ingredients: [{name:"æŒ‚é¢",img:""},{name:"è‘±æ²¹",img:""}] },
            { title: "æ—¥å¼é¥­å›¢", time: "10 min", tags: ["æŠ—é¥¿"], img: IMG_BASE + "1563102325-1a3b37905d49" + IMG_PARAMS, desc: "ç±³é¥­åŒ…æµ·è‹”ã€‚", ingredients: [{name:"ç±³é¥­",img:""},{name:"æµ·è‹”",img:""}] },

            // --- Day 3 ---
            { title: "ç´«è–¯èŠå£«çƒ", time: "10 min", tags: ["ç²—ç²®"], img: IMG_BASE + "1616428751508-3dc462744889" + IMG_PARAMS, desc: "è’¸ç´«è–¯å‹æ³¥åŒ…èŠå£«ã€‚", ingredients: [{name:"ç´«è–¯",img:""},{name:"èŠå£«",img:""}] },
            { title: "ç•ªèŒ„é¸¡è›‹ç–™ç˜©æ±¤", time: "10 min", tags: ["æ˜“æ¶ˆåŒ–"], img: IMG_BASE + "1547592166-23acbe34071b" + IMG_PARAMS, desc: "é…¸ç”œå¼€èƒƒã€‚", ingredients: [{name:"ç•ªèŒ„",img:""},{name:"é¢ç²‰",img:""}] },
            { title: "èŠ±ç”Ÿé…±é¦™è•‰åå¸", time: "3 min", tags: ["å¿«æ‰‹"], img: IMG_BASE + "1550614000-4b9519e07d72" + IMG_PARAMS, desc: "æ— éœ€å¼€ç«ã€‚", ingredients: [{name:"åå¸",img:""},{name:"é¦™è•‰",img:""}] },

            // --- Day 4 ---
            { title: "é²œè‚‰å°é¦„é¥¨", time: "8 min", tags: ["æ±¤æ°´"], img: IMG_BASE + "1596797038530-2c107229654b" + IMG_PARAMS, desc: "å†°ç®±å¸¸å¤‡é€Ÿå†»å°é¦„é¥¨ã€‚", ingredients: [{name:"é¦„é¥¨",img:""},{name:"ç´«èœ",img:""}] },
            { title: "ç‰›æ²¹æœæºå¿ƒè›‹", time: "6 min", tags: ["è„‘åŠ›"], img: IMG_BASE + "1525351484163-7529414395d8" + IMG_PARAMS, desc: "ç‰›æ²¹æœæ­é…ç…è›‹ã€‚", ingredients: [{name:"ç‰›æ²¹æœ",img:""},{name:"é¸¡è›‹",img:""}] },
            { title: "å°ç±³å—ç“œç²¥", time: "0 min", tags: ["å…»èƒƒ"], img: IMG_BASE + "1505253716371-bab3a29d6d09" + IMG_PARAMS, desc: "ç”µé¥­ç…²é¢„çº¦ã€‚", ingredients: [{name:"å°ç±³",img:""},{name:"å—ç“œ",img:""}] },

            // --- Day 5 ---
            { title: "é¸¡èƒ¸è‚‰æ²™æ‹‰", time: "8 min", tags: ["å‡è„‚"], img: IMG_BASE + "1546069901-ba9599a7e63c" + IMG_PARAMS, desc: "ç…ç†Ÿé¸¡èƒ¸è‚‰æ‹Œç”Ÿèœã€‚", ingredients: [{name:"é¸¡èƒ¸",img:""},{name:"ç”Ÿèœ",img:""}] },
            { title: "çº¢ç³–å‘ç³•", time: "10 min", tags: ["èƒ½é‡"], img: IMG_BASE + "1621655065166-73138356947c" + IMG_PARAMS, desc: "åŠæˆå“å‘ç³•è’¸10åˆ†é’Ÿã€‚", ingredients: [{name:"å‘ç³•",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "é…¸å¥¶æ°´æœæ", time: "3 min", tags: ["ç»´C"], img: IMG_BASE + "1488477181946-6428a0291777" + IMG_PARAMS, desc: "é…¸å¥¶åŠ æ°´æœã€‚", ingredients: [{name:"é…¸å¥¶",img:""},{name:"æ°´æœ",img:""}] },

            // --- Day 6 ---
            { title: "åŸ¹æ ¹æ‰‹æŠ“é¥¼", time: "5 min", tags: ["è§£é¦‹"], img: IMG_BASE + "1626078299034-297eb040a43e" + IMG_PARAMS, desc: "ä¸¤é¢ç…é»„ã€‚", ingredients: [{name:"æ‰‹æŠ“é¥¼",img:""},{name:"åŸ¹æ ¹",img:""}] },
            { title: "çº¢è–¯ç…®é¸¡è›‹", time: "10 min", tags: ["æç®€"], img: IMG_BASE + "1594970420448-6932a93361e6" + IMG_PARAMS, desc: "ä¸€é”…è’¸ç†Ÿã€‚", ingredients: [{name:"çº¢è–¯",img:""},{name:"é¸¡è›‹",img:""}] },
            { title: "è‚‰æ¾ä¸‰æ˜æ²»", time: "5 min", tags: ["å’¸é¦™"], img: IMG_BASE + "1484723091739-30a097e8f929" + IMG_PARAMS, desc: "åå¸å¤¹è‚‰æ¾ã€‚", ingredients: [{name:"è‚‰æ¾",img:""},{name:"åå¸",img:""}] },

            // --- Day 7 ---
            { title: "é»„é‡‘é¦’å¤´ç‰‡", time: "5 min", tags: ["å‰©é¥­"], img: IMG_BASE + "1626202166699-b1d5c7075b14" + IMG_PARAMS, desc: "è£¹è›‹æ¶²ç…è‡³é‡‘é»„ã€‚", ingredients: [{name:"é¦’å¤´",img:""},{name:"é¸¡è›‹",img:""}] },
            { title: "ç‰›å¥¶ç‰ç±³ç‰‡", time: "2 min", tags: ["æé€Ÿ"], img: IMG_BASE + "1520025642999-566275e5262c" + IMG_PARAMS, desc: "å†²ç‰›å¥¶ã€‚", ingredients: [{name:"ç‰ç±³ç‰‡",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "è›‹ç‚’é¥­", time: "8 min", tags: ["ç®¡é¥±"], img: IMG_BASE + "1603133872878-684f208fb84b" + IMG_PARAMS, desc: "å‰©ç±³é¥­å¿«ç‚’ã€‚", ingredients: [{name:"ç±³é¥­",img:""},{name:"é¸¡è›‹",img:""}] },

            // --- Day 8 ---
            { title: "é¸¡è‚‰å·", time: "8 min", tags: ["ä¾¿æº"], img: IMG_BASE + "1626700051175-6818013e1d4f" + IMG_PARAMS, desc: "å·é¥¼å¤¹é¸¡æŸ³ã€‚", ingredients: [{name:"å·é¥¼",img:""},{name:"é¸¡æŸ³",img:""}] },
            { title: "å‘³å™Œæ±¤æ³¡é¥­", time: "5 min", tags: ["æš–èº«"], img: IMG_BASE + "1547592180-85f173990554" + IMG_PARAMS, desc: "é€Ÿé£Ÿå‘³å™Œæ±¤ã€‚", ingredients: [{name:"å‘³å™Œ",img:""},{name:"ç±³é¥­",img:""}] },
            { title: "è“è“å±±è¯æ³¥", time: "10 min", tags: ["å¥è„¾"], img: IMG_BASE + "1567529684892-09290a1b2d05" + IMG_PARAMS, desc: "å±±è¯è’¸ç†Ÿæ·‹é…±ã€‚", ingredients: [{name:"å±±è¯",img:""},{name:"è“è“é…±",img:""}] },

            // --- Day 9 ---
            { title: "åå¸æŠ«è¨", time: "10 min", tags: ["è¶£å‘³"], img: IMG_BASE + "1565299624946-b28f40a0ae38" + IMG_PARAMS, desc: "é¦™è‚ èŠå£«ç…åŒ–ã€‚", ingredients: [{name:"åå¸",img:""},{name:"èŠå£«",img:""}] },
            { title: "é»‘èŠéº»ç³Š", time: "3 min", tags: ["ä¹Œå‘"], img: IMG_BASE + "1599321955726-e04842d6c2e7" + IMG_PARAMS, desc: "å†²çƒ­ç‰›å¥¶ã€‚", ingredients: [{name:"èŠéº»ç²‰",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "è¥¿è‘«èŠ¦å¡Œç³Š", time: "10 min", tags: ["è½¯å«©"], img: IMG_BASE + "1604908176997-125f25cc6f3d" + IMG_PARAMS, desc: "è”¬èœç…é¥¼ã€‚", ingredients: [{name:"è¥¿è‘«èŠ¦",img:""},{name:"é¢ç²‰",img:""}] },

            // --- Day 10 ---
            { title: "å¹¿å¼è‚ ç²‰", time: "8 min", tags: ["æ¸…æ·¡"], img: IMG_BASE + "1555126634-323283e090fa" + IMG_PARAMS, desc: "è¶Šå—æ˜¥å·çš®åšæ³•ã€‚", ingredients: [{name:"æ˜¥å·çš®",img:""},{name:"é¸¡è›‹",img:""}] },
            { title: "æ³•å¼åå¸", time: "8 min", tags: ["é¦™ç”œ"], img: IMG_BASE + "1484723091739-30a097e8f929" + IMG_PARAMS, desc: "æµ¸è›‹æ¶²ç…é»„ã€‚", ingredients: [{name:"åå¸",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "è‘±æ²¹æ‹Œé¢", time: "8 min", tags: ["é²œç¾"], img: IMG_BASE + "1612929633738-8fe44f7ec841" + IMG_PARAMS, desc: "é¢æ¡æ‹Œè‘±æ²¹ã€‚", ingredients: [{name:"é¢æ¡",img:""},{name:"è‘±æ²¹",img:""}] }
        ];

        // è‡ªåŠ¨è¡¥å……é€šç”¨é£Ÿæå›¾ (é˜²æ­¢ç©ºç™½)
        RECIPE_DB.forEach(r => {
            if(!r.steps) r.steps = [{text:"1. å‡†å¤‡é£Ÿæã€‚",note:""},{text:"2. ç®€å•çƒ¹é¥ªã€‚",note:""},{text:"3. äº«ç”¨ç¾å‘³ã€‚",note:""}];
            r.ingredients.forEach(i => { 
                if(!i.img) i.img = IMG_BASE + "1606914469725-e39c34bfdebe" + IMG_PARAMS; // é€šç”¨é£Ÿæå›¾
            });
        });

        // ================= 2. é¡µé¢åˆå§‹åŒ–é€»è¾‘ =================
        function initHeader() {
            const now = new Date();
            const weekDays = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
            document.getElementById('gregorianDate').innerText = 
                `${now.getMonth()+1}.${now.getDate()} å‘¨${weekDays[now.getDay()]}`;
            
            // ç®€å•å†œå†/èŠ‚æ°”æ¨¡æ‹Ÿ (çœŸå®ç¯å¢ƒå»ºè®®æ¥API)
            const day = now.getDate();
            let lunar = "å†œå†å†¬æœˆ";
            let term = "å¤§é›ª";
            if(day > 21) term = "å†¬è‡³";
            if(day < 15) lunar += "åˆ" + ["ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹"][day>9?day-10:day-1];
            
            document.getElementById('lunarText').innerText = lunar;
            document.getElementById('solarTerm').innerText = term;
            
            // 10å¤©å¾ªç¯ç®—æ³•
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            const cycleDay = (dayOfYear % 10) + 1;
            document.getElementById('cycleDay').innerText = cycleDay;

            return dayOfYear;
        }

        const dayOfYear = initHeader();

        // æ¸²æŸ“é¦–é¡µ
        const homeList = document.getElementById('homeRecipeList');
        const startIdx = (dayOfYear * 3) % RECIPE_DB.length;
        [0,1,2].forEach((offset) => {
            const idx = (startIdx + offset) % RECIPE_DB.length;
            const r = RECIPE_DB[idx];
            homeList.innerHTML += `
                <div class="recipe-card-large" onclick="openRecipe(${idx})">
                    <div class="time-badge">${r.time}</div>
                    <img src="${r.img}" class="recipe-img-large" onerror="this.onerror=null;this.src='https://dummyimage.com/600x400/235347/fff?text=Food';">
                    <div class="recipe-info">
                        <div class="recipe-name">${r.title}</div>
                        <div style="font-size:0.9rem; color:#ccc;">${r.desc}</div>
                        <div class="recipe-tags">
                            ${r.tags.map(t=>`<span class="tag">${t}</span>`).join('')}
                        </div>
                    </div>
                </div>`;
        });

        // æ¸²æŸ“æ›´å¤š
        const moreList = document.getElementById('moreRecipeGrid');
        RECIPE_DB.forEach((r, idx) => {
            moreList.innerHTML += `
                <div class="grid-card" onclick="openRecipe(${idx})">
                    <img src="${r.img}" onerror="this.src='https://dummyimage.com/200x200/235347/fff?text=Food';">
                    <div class="info">
                        <div class="title">${r.title}</div>
                        <div style="font-size:0.8rem; color:var(--accent-green); margin-top:5px;">${r.time}</div>
                    </div>
                </div>`;
        });

        // ================= 3. å¨ç¥æ¦œ (å›¾æ ‡åŒ–) =================
        let currentUserRole = null;
        // è§’è‰²é…ç½® (FontAwesomeå›¾æ ‡)
        let users = JSON.parse(localStorage.getItem('breakfastUsers')) || [
            { id: 'mom', name: "å¦ˆå¦ˆ", icon: "fas fa-user-nurse", score: 5, history: [] }, 
            { id: 'dad', name: "çˆ¸çˆ¸", icon: "fas fa-user-tie", score: 2, history: [] }, 
            { id: 'kid', name: "å¥å®", icon: "fas fa-child", score: 3, history: [] }
        ];

        function renderRank() {
            const sortedUsers = [...users].sort((a,b) => b.score - a.score);
            const list = document.getElementById('rankingList');
            list.innerHTML = '';

            sortedUsers.forEach((u, idx) => {
                let historyHtml = u.history.length > 0 
                    ? `<div class="history-grid">${u.history.map(img => `<img src="${img}" class="history-img">`).join('')}</div>`
                    : '<div style="text-align:center; color:#666; font-size:0.8rem; padding:10px;">æš‚æ— æ‰“å¡è®°å½•</div>';

                const html = `
                    <div class="rank-item-wrapper">
                        <div class="rank-item" onclick="toggleHistory(this)">
                            <div class="rank-icon-box">
                                <i class="${u.icon}"></i>
                            </div>
                            <div style="flex:1;">
                                <div style="font-weight:bold; color:white;">${u.name} ${idx===0?'<span style="color:gold;">ğŸ‘‘</span>':''}</div>
                                <div style="font-size:0.8rem; color:var(--accent-green);">å¨è‰ºå€¼: ${u.score}</div>
                            </div>
                            <div class="rank-arrow"><i class="fas fa-chevron-down"></i></div>
                        </div>
                        <div class="history-panel">
                            ${historyHtml}
                        </div>
                    </div>
                `;
                list.innerHTML += html;
            });
        }

        function selectRole(roleId) {
            currentUserRole = roleId;
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('btn-'+roleId).classList.add('selected');
            
            const btn = document.getElementById('mainUploadBtn');
            const u = users.find(u=>u.id===roleId);
            btn.innerHTML = `<i class="fas fa-camera"></i> ${u.name}åšå¥½å•¦ï¼ä¸Šä¼ `;
            btn.classList.add('active');
        }

        function triggerUpload() {
            if(!currentUserRole) return;
            document.getElementById('uploadInput').click();
        }

        function handleUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const u = users.find(u => u.id === currentUserRole);
                    u.score += 1;
                    u.history.unshift(e.target.result);
                    localStorage.setItem('breakfastUsers', JSON.stringify(users));
                    alert(`âœ… æ‰“å¡æˆåŠŸï¼\n${u.name}çš„å¨è‰ºå€¼+1`);
                    renderRank();
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function toggleHistory(el) {
            el.classList.toggle('open');
            const panel = el.nextElementSibling;
            panel.style.display = panel.style.display === "block" ? "none" : "block";
        }

        renderRank();

        // ================= 4. è¯¦æƒ…é¡µ & å¯¼èˆª =================
        function openRecipe(index) {
            const r = RECIPE_DB[index];
            const html = `
                <img src="${r.img}" style="width:100%; height:260px; object-fit:cover;">
                <div style="padding:20px;">
                    <h2 style="color:#235347; margin-top:0;">${r.title}</h2>
                    <p style="background:rgba(142, 182, 155, 0.2); padding:10px; border-radius:8px;">${r.desc}</p>
                    <h4 style="border-left:4px solid #235347; padding-left:10px;">æ‰€éœ€é£Ÿæ</h4>
                    <div class="ingredients-box">
                        <div class="ing-grid">
                            ${r.ingredients.map(i=>`
                                <div class="ing-item">
                                    <img src="${i.img}" class="ing-img">
                                    <div style="font-size:0.8rem; margin-top:5px;">${i.name}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <h4 style="border-left:4px solid #235347; padding-left:10px;">åšæ³•</h4>
                    ${r.steps.map(s=>`<div style="padding:10px 0; border-bottom:1px dashed #ccc;">${s.text}</div>`).join('')}
                    <div style="height:50px;"></div>
                </div>
            `;
            document.getElementById('modalContent').innerHTML = html;
            document.getElementById('recipeModal').style.display = 'block';
        }

        function closeModal() { document.getElementById('recipeModal').style.display = 'none'; }
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0,0);
            
            document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active'));
            if(pageId === 'page-home') document.getElementById('nav-home').classList.add('active');
            if(pageId === 'page-more') document.getElementById('nav-more').classList.add('active');
            if(pageId === 'page-rank') document.getElementById('nav-rank').classList.add('active');
        }
    </script>
</body>
</html>
