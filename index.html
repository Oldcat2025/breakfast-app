<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™¨æ›¦é£Ÿå…‰ - å¥å®çš„å…ƒæ°”æ—©é¤</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- é…è‰²æ–¹æ¡ˆ (Morandi Green) --- */
        :root {
            --bg-deep: #051F20;
            --bg-main: #0B2B26;
            --card-dark: #163832;
            --card-mid: #235347;
            --accent-green: #8EB69B; 
            --accent-gold: #E09F3E;  
            --text-light: #DAF1DE;
            --text-white: #FFFFFF;
            --shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, var(--bg-deep) 0%, var(--bg-main) 100%);
            color: var(--text-light);
            margin: 0; padding: 0; min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 100px;
        }

        /* --- åŠ¨ç”» --- */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- é¡¶éƒ¨ Header --- */
        .header-container {
            background: var(--card-dark);
            padding: 20px 20px 30px;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            text-align: center;
        }
        .top-info-bar {
            display: inline-flex; gap: 8px; font-size: 0.8rem; color: var(--accent-green);
            background: rgba(0,0,0,0.3); padding: 6px 15px; border-radius: 20px;
            margin-bottom: 15px; align-items: center;
        }
        .info-divider { opacity: 0.4; }
        .greeting { font-size: 1.6rem; font-weight: bold; color: var(--text-white); margin: 10px 0; }
        .cycle-tip { font-size: 0.85rem; color: #888; }

        /* --- é€šç”¨æ ‡é¢˜ --- */
        .section-title {
            padding: 25px 20px 15px; font-size: 1.1rem; font-weight: bold; display: flex; align-items: center; color: var(--text-white);
        }
        .section-title::before {
            content: ''; display: block; width: 5px; height: 18px; background: var(--accent-green); margin-right: 12px; border-radius: 3px;
        }
        
        /* --- å­é¡µé¢å¤´ --- */
        .sub-header {
            background: var(--card-dark); padding: 15px 20px; display: flex; align-items: center; 
            justify-content: space-between; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        /* --- é¦–é¡µåˆ—è¡¨ (Vertical) --- */
        .recipe-list-vertical { display: flex; flex-direction: column; gap: 20px; padding: 0 20px; }
        .recipe-card-large {
            background: var(--card-mid); border-radius: 20px; overflow: hidden; box-shadow: var(--shadow);
            position: relative; transition: transform 0.2s;
        }
        .recipe-card-large:active { transform: scale(0.98); }
        .recipe-img-large { height: 190px; width: 100%; object-fit: cover; background-color: var(--card-dark); transition: opacity 0.3s;}
        .recipe-info { padding: 15px 20px; }
        .recipe-name { font-size: 1.2rem; font-weight: bold; color: var(--text-white); margin-bottom: 6px; }
        .recipe-tags { display: flex; gap: 8px; margin-top: 8px; }
        .tag { font-size: 0.75rem; padding: 3px 8px; border-radius: 6px; background: rgba(0,0,0,0.3); color: var(--accent-green); }
        .time-badge {
            position: absolute; top: 15px; right: 15px; background: var(--accent-green); color: #051F20;
            padding: 4px 10px; border-radius: 10px; font-weight: bold; font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* --- æ›´å¤šåˆ—è¡¨ (Grid) --- */
        .recipe-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; }
        .grid-card { background: var(--card-mid); border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; height: 100%; }
        .grid-card img { width: 100%; height: 110px; object-fit: cover; background: var(--card-dark); }
        .grid-card .info { padding: 10px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .grid-card .title { font-size: 0.9rem; font-weight: bold; color: var(--text-white); line-height: 1.3; }

        /* --- å¨ç¥æ¦œ (æ ·å¼å‡çº§) --- */
        .leaderboard { margin: 20px; background: var(--card-dark); border-radius: 24px; padding: 20px; }
        
        .role-selector {
            display: flex; justify-content: center; gap: 25px; margin-bottom: 25px; 
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 25px;
        }
        
        /* è§’è‰²æŒ‰é’®å®¹å™¨ */
        .role-btn {
            width: 70px; height: 70px; 
            border-radius: 50%; 
            background: linear-gradient(145deg, #1a423b, #13302b);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            cursor: pointer; 
            border: 2px solid rgba(255,255,255,0.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        /* SVG å›¾æ ‡é€šç”¨æ ·å¼ */
        .role-svg {
            width: 40px; height: 40px;
            fill: none;
            stroke: #668880; /* æœªé€‰ä¸­æ—¶çš„æ·¡ç»¿è‰² */
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: all 0.3s;
        }

        /* é€‰ä¸­çŠ¶æ€ */
        .role-btn.selected { 
            background: var(--card-mid); 
            border-color: var(--accent-gold); 
            box-shadow: 0 0 20px rgba(224, 159, 62, 0.4); 
            transform: scale(1.15); 
        }
        .role-btn.selected .role-svg {
            stroke: var(--accent-gold); /* é€‰ä¸­å˜é‡‘ */
            filter: drop-shadow(0 0 2px rgba(224, 159, 62, 0.5));
        }
        
        /* é€‰ä¸­æŒ‡ç¤ºç‚¹ */
        .role-btn.selected::after {
            content: ''; position: absolute; bottom: -8px; 
            width: 6px; height: 6px; background: var(--accent-gold); border-radius: 50%;
        }
        
        .rank-item { 
            display: flex; align-items: center; padding: 12px; margin-bottom: 10px; 
            background: rgba(255,255,255,0.05); border-radius: 12px; cursor: pointer;
        }
        .rank-icon-box { 
            width: 40px; height: 40px; border-radius: 50%; background: var(--card-mid); border: 1px solid var(--accent-green);
            display: flex; align-items: center; justify-content: center; color: white; margin-right: 12px;
        }
        .history-panel { display: none; background: rgba(0,0,0,0.2); padding: 10px; margin-bottom: 10px; border-radius: 8px; }
        .history-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .history-img { width: 100%; height: 70px; object-fit: cover; border-radius: 6px; background: var(--card-dark); }

        /* --- åº•éƒ¨å¯¼èˆª --- */
        .bottom-dock {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            background: rgba(22, 56, 50, 0.95); backdrop-filter: blur(12px);
            padding: 10px 30px; border-radius: 50px; display: flex; gap: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6); z-index: 900; border: 1px solid rgba(255,255,255,0.1);
        }
        .dock-btn { 
            display: flex; flex-direction: column; align-items: center; color: #888; cursor: pointer; width: 45px;
        }
        .dock-btn i { font-size: 1.3rem; margin-bottom: 3px; }
        .dock-btn span { font-size: 0.7rem; }
        .dock-btn.active { color: var(--accent-green); transform: translateY(-2px); }

        /* --- å¼¹çª— --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; overflow-y: auto; }
        .modal-content { background: #F4F1EA; color: #333; margin: 15px; border-radius: 20px; min-height: 85vh; padding-bottom: 40px; }
        .ing-grid { display: flex; gap: 15px; overflow-x: auto; padding: 10px 0; }
        .ing-item { text-align: center; min-width: 60px; }
        .ing-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; background: #ddd; }
        
        .step-item { padding: 12px 0; border-bottom: 1px dashed #ccc; display: flex; gap: 10px; }
        .step-num { font-weight: bold; color: var(--card-mid); font-size: 1.1rem; }
        .step-text { font-size: 0.95rem; line-height: 1.6; color: #555; }
        .step-tips { display: block; margin-top: 5px; color: #E09F3E; font-size: 0.85rem; font-weight: bold;}

    </style>
</head>
<body>

    <div id="page-home" class="page active">
        <div class="header-container">
            <div class="top-info-bar">
                <span id="dateStr">12.11 å‘¨å››</span>
                <span class="info-divider">|</span>
                <span id="lunarStr">å†œå†å†¬æœˆ</span>
                <span class="info-divider">|</span>
                <span id="termStr">å¤§é›ª</span>
                <span class="info-divider">|</span>
                <span><i class="fas fa-sun"></i> æ™´</span>
            </div>
            <div class="greeting">æ—©å®‰ï¼Œå¥å®ï¼</div>
            <div class="cycle-tip">ğŸ“… 10å¤©ä¸é‡æ ·æ¨èï¼šç¬¬ <span id="cycleNum" style="color:var(--accent-gold); font-weight:bold;">1</span> å¤©</div>
        </div>

        <div class="section-title">ä»Šæ—¥æ¨èå…ƒæ°”æ—©é¤ï¼ˆ10åˆ†é’Ÿå¤‡å¦¥ï¼‰</div>
        <div class="recipe-list-vertical" id="homeList"></div>
    </div>

    <div id="page-more" class="page">
        <div class="sub-header">
            <span style="color:white; font-weight:bold;">âœ¨ æ›´å¤šèœè°± (æŒ‰æ¨èåº¦æ’åº)</span>
        </div>
        <div class="recipe-grid" id="moreList"></div>
    </div>

    <div id="page-rank" class="page">
        <div class="sub-header">
            <span style="color:white; font-weight:bold;">ğŸ† å®¶åº­å¨ç¥äº‰éœ¸èµ›</span>
        </div>
        <div class="leaderboard">
            <div class="role-selector">
                <div class="role-btn" onclick="setRole('mom')" id="r-mom">
                    <svg class="role-svg" viewBox="0 0 24 24">
                        <path d="M12 2a5 5 0 1 0 5 5 5 5 0 0 0-5-5zm0 8a5 5 0 0 1-5-5 5 5 0 0 1 10 0 5 5 0 0 1-5 5z"/>
                        <path d="M16 7.5C16 10.5 13.5 12 12 12s-4-1.5-4-4.5" stroke-opacity="0.5"/>
                        <path d="M20 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M4 21v-2a4 4 0 0 1 3-3.87"/>
                    </svg>
                </div>
                <div class="role-btn" onclick="setRole('dad')" id="r-dad">
                    <svg class="role-svg" viewBox="0 0 24 24">
                        <path d="M12 2a5 5 0 1 0 5 5 5 5 0 0 0-5-5zm0 8a5 5 0 0 1-5-5 5 5 0 0 1 10 0 5 5 0 0 1-5 5z"/>
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    </svg>
                </div>
                <div class="role-btn" onclick="setRole('kid')" id="r-kid">
                    <svg class="role-svg" viewBox="0 0 24 24">
                        <circle cx="12" cy="8" r="4"/>
                        <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                        <path d="M8 6h8a4 4 0 0 1 0 8"/> <path d="M8 6a4 4 0 0 1 8 0"/>
                    </svg>
                </div>
            </div>

            <div id="rankList"></div>
            
            <div style="text-align:center; margin-top:20px;">
                <input type="file" id="upFile" accept="image/*" style="display:none;" onchange="doUpload(this)">
                <button id="upBtn" onclick="clkUpload()" style="width:100%; padding:15px; border-radius:15px; border:none; background:#444; color:#aaa; font-weight:bold; font-size:0.9rem;">
                    <i class="fas fa-camera"></i> è¯·å…ˆç‚¹å‡»ä¸Šæ–¹è§’è‰²å¤´åƒï¼Œå†æ‹ç…§ä¸Šä¼ 
                </button>
            </div>
        </div>
    </div>

    <div class="bottom-dock">
        <div class="dock-btn active" onclick="goPage('page-home')" id="nav-home">
            <i class="fas fa-home"></i><span>é¦–é¡µ</span>
        </div>
        <div class="dock-btn" onclick="goPage('page-more')" id="nav-more">
            <i class="fas fa-th-large"></i><span>æ›´å¤š</span>
        </div>
        <div class="dock-btn" onclick="goPage('page-rank')" id="nav-rank">
            <i class="fas fa-trophy"></i><span>å¨ç¥æ¦œ</span>
        </div>
    </div>

    <div id="modal" class="modal">
        <div style="position:fixed; top:20px; left:20px; z-index:1002;">
            <button onclick="closeModal()" style="background:rgba(0,0,0,0.6); border:none; color:white; padding:8px 15px; border-radius:20px;">
                <i class="fas fa-arrow-left"></i> å…³é—­
            </button>
        </div>
        <div id="modalBody" class="modal-content"></div>
    </div>

    <script>
        // === ä¿®å¤ï¼šä½¿ç”¨ Base64 ç¼–ç çš„æ·±å¢¨ç»¿åº•è‰² SVGï¼Œå½»åº•è§£å†³é“¾æ¥å¤±æ•ˆé—®é¢˜ ===
        // è¿™æ˜¯ä¸€ä¸ªçº¯è‰²èƒŒæ™¯ + æ–‡å­—çš„å›¾ç‰‡æ•°æ®ï¼Œæµè§ˆå™¨ç›´æ¥è§£æï¼Œä¸éœ€è¦è”ç½‘
        const DARK_PLACEHOLDER_IMG = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA0MDAgMzAwJz48cmVjdCB3aWR0aD0nMTAwJScgaGVpZ2h0PScxMDAlJyBmaWxsPScjMTYzODMyJy8+PHRleHQgeD0nNTAlJyB5PSc1MCUnIGRvbWluYW50LWJhc2VsaW5lPSdtaWRkbGUnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZpbGw9JyMzRDZFNjAnIGZvbnQtc2l6ZT0nMjQnPuaaZWXml6VbvueJhzwvdGV4dD48L3N2Zz4=";

        const COMMON_ING_IMG = "https://images.unsplash.com/photo-1606914469725-e39c34bfdebe?auto=format&fit=crop&w=100&q=80";

        // === æ ¸å¿ƒæ•°æ® ===
        const DB = [
            {
                title: "é»„é‡‘è›‹ç…åå¸", time: "5 min", tags: ["å‰©é¥­ç¥å™¨","é¦™è½¯"],
                img: "https://images.unsplash.com/photo-1484723091739-30a097e8f929?auto=format&fit=crop&w=800&q=80",
                desc: "å‰©åå¸è£¹æ»¡è›‹æ¶²ç…è‡³é‡‘é»„ï¼Œå¥¶é¦™æµ“éƒã€‚",
                ings: [{n:"åå¸",i:""},{n:"é¸¡è›‹",i:""},{n:"ç‰›å¥¶",i:""}],
                steps: [
                    {t:"é¸¡è›‹2ä¸ªæ‰“æ•£ï¼ŒåŠ å…¥30mlç‰›å¥¶æ…æ‹Œå‡åŒ€ï¼Œå°†åå¸åˆ‡å»å››è¾¹ç¡¬çš®ã€‚", p:"ğŸ’¡ åŠ ç‰›å¥¶èƒ½è®©åå¸æ›´è½¯å«©ï¼"},
                    {t:"å¹³åº•é”…åˆ·è–„æ²¹ï¼Œå¼€å°ç«çƒ­é”…ã€‚å°†åå¸å¿«é€Ÿåœ¨è›‹æ¶²é‡Œè˜¸ä¸€ä¸‹ï¼ˆæ­£åé¢å„1ç§’ï¼‰ã€‚", p:"âš ï¸ ä¸è¦æ³¡å¤ªä¹…ï¼Œå¦åˆ™é¢åŒ…ä¼šçƒ‚ã€‚"},
                    {t:"æ”¾å…¥é”…ä¸­ï¼Œå°ç«æ…¢ç…è‡³ä¸¤é¢é‡‘é»„ï¼ˆçº¦æ¯é¢1åˆ†é’Ÿï¼‰ï¼Œå‡ºé”…å¯æ·‹å°‘è®¸èœ‚èœœã€‚", p:"ğŸ”¥ å…¨ç¨‹å°ç«ï¼Œé¿å…ç…ç³Šã€‚"}
                ]
            },
            {
                title: "å¿«æ‰‹è‘±æ²¹æ‹Œé¢", time: "8 min", tags: ["å¼€èƒƒ","èƒ½é‡"],
                img: "https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?auto=format&fit=crop&w=800&q=80",
                desc: "ä¸€æŠŠæŒ‚é¢ç…®ç†Ÿï¼Œæ·‹ä¸Šé…±æ²¹é¦™æ²¹é†‹ï¼Œæ’’ä¸Šè‘±èŠ±ã€‚",
                ings: [{n:"æŒ‚é¢",i:""},{n:"å°è‘±",i:""},{n:"é…±æ²¹",i:""}],
                steps: [
                    {t:"å…ˆè°ƒé…±æ±ï¼šç¢—ä¸­æ”¾2å‹ºç”ŸæŠ½ã€åŠå‹ºè€æŠ½ã€1å‹ºç™½ç³–ã€åŠå‹ºé¦™æ²¹æ…æ‹Œå‡åŒ€ã€‚", p:"ğŸ’¡ æå‰è°ƒæ±æ˜¯å¿«æ‰‹çš„å…³é”®ã€‚"},
                    {t:"æ°´çƒ§å¼€ç…®é¢ï¼ˆçº¦4-5åˆ†é’Ÿï¼‰ï¼Œç…®é¢æ—¶åˆ‡ç‚¹è‘±èŠ±ã€‚", p:""},
                    {t:"é¢æ¡ç…®ç†Ÿæå‡ºè¿‡å‡‰å¼€æ°´ï¼ˆæ›´åŠ²é“ï¼‰ï¼Œæ²¥å¹²æ°´ä»½æ”¾å…¥ç¢—ä¸­ï¼Œæ·‹ä¸Šé…±æ±å’Œè‘±èŠ±æ‹ŒåŒ€å³å¯ã€‚", p:"âœ… æ—©ä¸Šä¸æƒ³ç†¬è‘±æ²¹ï¼Œç›´æ¥ç”¨é¦™æ²¹ä»£æ›¿ä¹Ÿå¾ˆé¦™ã€‚"}
                ]
            },
            {
                title: "åšæœç‰›å¥¶ç‡•éº¦ç²¥", time: "5 min", tags: ["è¡¥è„‘","é’™"],
                img: "https://images.unsplash.com/photo-1517601278517-456741619dad?auto=format&fit=crop&w=800&q=80",
                desc: "ç‡•éº¦ç‰‡åŠ ç‰›å¥¶ç…®çƒ­ï¼Œæ’’ä¸Šä¸€æŠŠæ¯æ—¥åšæœã€‚",
                ings: [{n:"ç‡•éº¦",i:""},{n:"ç‰›å¥¶",i:""},{n:"åšæœ",i:""}],
                steps: [
                    {t:"å°å¥¶é”…å€’å…¥250mlçº¯ç‰›å¥¶ï¼Œå¼€ä¸­å°ç«åŠ çƒ­è‡³è¾¹ç¼˜å¾®å¾®å†’æ³¡ã€‚", p:"âš ï¸ ç‰›å¥¶ä¸è¦å¤§ç«ç…®æ²¸ï¼Œè¥å…»ä¼šæµå¤±ã€‚"},
                    {t:"å€’å…¥å³é£Ÿç‡•éº¦ç‰‡ï¼Œæ…æ‹Œå‡åŒ€åå…³ç«ï¼Œç›–ä¸Šç›–å­ç„–2-3åˆ†é’Ÿã€‚", p:"ğŸ’¡ åˆ©ç”¨ä½™æ¸©ç„–ç†Ÿï¼Œå£æ„Ÿæ›´ç²˜ç¨ ã€‚"},
                    {t:"ç››å‡ºåï¼Œè¡¨é¢æ’’ä¸Šä¸€æŠŠæ¯æ—¥åšæœå’Œè”“è¶Šè“å¹²ï¼Œå¢åŠ å£æ„Ÿå±‚æ¬¡ã€‚", p:""}
                ]
            },
            {
                title: "ç´«èœè™¾çš®å°äº‘å", time: "8 min", tags: ["æ±¤æ°´","æš–èƒƒ"],
                img: "https://images.unsplash.com/photo-1563245372-f21724e3856d?auto=format&fit=crop&w=800&q=80",
                desc: "å®¶ä¸­å¸¸å¤‡é€Ÿå†»å°äº‘åï¼Œæ±¤åº•åŠ ç´«èœè™¾çš®ã€‚",
                ings: [{n:"äº‘å",i:""},{n:"ç´«èœ",i:""},{n:"è™¾çš®",i:""}],
                steps: [
                    {t:"æ±¤ç¢—é‡Œæå‰æ”¾ï¼šç´«èœç¢ã€è™¾çš®ã€ä¸€ç‚¹ç‚¹ç›ã€ç™½èƒ¡æ¤’ç²‰å’Œé¦™æ²¹ã€‚", p:"ğŸ’¡ ç¢—åº•æ–™æ˜¯çµé­‚ã€‚"},
                    {t:"æ°´å¼€ä¸‹å…¥é€Ÿå†»äº‘åï¼Œä¿æŒä¸­ç«ç…®è‡³äº‘åå…¨éƒ¨æµ®èµ·ï¼ˆçº¦4-5åˆ†é’Ÿï¼‰ã€‚", p:""},
                    {t:"å…ˆèˆ€ä¸€å‹ºçƒ­æ±¤å†²å…¥ç¢—åº•åŒ–å¼€è°ƒæ–™ï¼Œå†æå…¥äº‘åå³å¯ã€‚", p:"ğŸ”¥ å…ˆå†²æ±¤å†æ”¾äº‘åï¼Œå‘³é“æ›´åŒ€ã€‚"}
                ]
            },
            {
                title: "æ»‘è›‹ç«è…¿ä¸‰æ˜æ²»", time: "5 min", tags: ["é«˜è›‹ç™½","å¿«æ‰‹"],
                img: "https://images.unsplash.com/photo-1525351484163-7529414395d8?auto=format&fit=crop&w=800&q=80",
                desc: "é¸¡è›‹ç‚’å«©ï¼Œå¤¹åœ¨ä¸¤ç‰‡åå¸ä¸­é—´ã€‚",
                ings: [{n:"åå¸",i:""},{n:"é¸¡è›‹",i:""},{n:"ç«è…¿",i:""}],
                steps: [
                    {t:"å¹³åº•é”…å°‘æ²¹ï¼Œå…ˆå°†ç«è…¿ç‰‡ä¸¤é¢ç…é¦™ç››å‡ºã€‚", p:""},
                    {t:"é¸¡è›‹æ‰“æ•£å€’å…¥é”…ä¸­ï¼Œä¸­å°ç«å¿«é€Ÿåˆ’æ•£ï¼Œå‘ˆåŠå‡å›ºçŠ¶å³å¯å…³ç«ã€‚", p:"âš ï¸ é¸¡è›‹ä¸è¦ç‚’å¤ªè€ï¼Œåˆ©ç”¨ä½™æ¸©çƒ«ç†Ÿæœ€å«©ã€‚"},
                    {t:"åå¸ä¸æ”¾æ²¹ç¨å¾®çƒ˜çƒ­ï¼Œä¾æ¬¡é“ºä¸Šç”Ÿèœã€ç«è…¿ã€æ»‘è›‹ï¼Œç›–ä¸Šå¦ä¸€ç‰‡åå¸å¯¹è§’åˆ‡å¼€ã€‚", p:""}
                ]
            },
            {
                title: "å¹¿å¼è’¸æ°´è›‹", time: "10 min", tags: ["å«©æ»‘","å¥½å¸æ”¶"],
                img: "https://images.unsplash.com/photo-1512443048503-45607db35378?auto=format&fit=crop&w=800&q=80",
                desc: "é¸¡è›‹åŠ æ¸©æ°´æ‰“åŒ€ï¼Œè’¸10åˆ†é’Ÿæ·‹é…±æ²¹ã€‚",
                ings: [{n:"é¸¡è›‹",i:""},{n:"æ¸©æ°´",i:""},{n:"é…±æ²¹",i:""}],
                steps: [
                    {t:"é¸¡è›‹2ä¸ªæ‰“å…¥ç¢—ä¸­ï¼ŒåŠ å…¥1.5å€çš„æ¸©æ°´ï¼ˆçº¦40åº¦ï¼‰ï¼Œå……åˆ†æ…æ‰“å‡åŒ€ã€‚", p:"ğŸ’¡ è›‹æ°´æ¯”ä¾‹1:1.5æœ€å«©ã€‚"},
                    {t:"ç”¨æ»¤ç½‘è¿‡æ»¤æ‰è›‹æ¶²ä¸­çš„æ³¡æ²«ï¼ˆå…³é”®ï¼ï¼‰ï¼Œç›–ä¸Šä¿é²œè†œå¹¶æ‰å‡ ä¸ªå°å­”ã€‚", p:"âš ï¸ è¿‡æ»¤å’Œä¿é²œè†œæ˜¯è¡¨é¢å¹³æ»‘å¦‚é•œçš„å…³é”®ã€‚"},
                    {t:"æ°´å¼€åä¸Šé”…è’¸8-10åˆ†é’Ÿï¼Œå…³ç«ç„–2åˆ†é’Ÿï¼Œå‡ºé”…æ·‹ä¸Šç”ŸæŠ½å’Œé¦™æ²¹ã€‚", p:""}
                ]
            },
            {
                title: "è“è“å±±è¯æ³¥", time: "10 min", tags: ["å¥è„¾","ç”œç‚¹"],
                img: "https://images.unsplash.com/photo-1550523024-65939765876e?auto=format&fit=crop&w=800&q=80", 
                desc: "é“æ£å±±è¯è’¸ç†Ÿå‹æ³¥ï¼Œæ·‹ä¸Šè“è“é…±ã€‚",
                ings: [{n:"å±±è¯",i:""},{n:"è“è“é…±",i:""}],
                steps: [
                    {t:"é“æ£å±±è¯å»çš®åˆ‡æˆè–„ç‰‡ï¼ˆè¶Šè–„è’¸å¾—è¶Šå¿«ï¼‰ï¼Œæ”¾å…¥å¾®æ³¢ç‚‰ä¸“ç”¨ç¢—åŠ å°‘è®¸æ°´ï¼Œé«˜ç«æ‰“5-6åˆ†é’Ÿã€‚", p:"ğŸ’¡ ç”¨å¾®æ³¢ç‚‰æ¯”è’¸é”…å¿«ä¸€å€ï¼"},
                    {t:"å–å‡ºå±±è¯è¶çƒ­ç”¨å‹ºå­å‹æˆæ³¥ï¼Œå¦‚æœå¤ªå¹²å¯ä»¥åŠ ä¸€ç‚¹ç‰›å¥¶ã€‚", p:""},
                    {t:"å°†å±±è¯æ³¥å †æˆå°å±±å½¢çŠ¶ï¼Œæ·‹ä¸Šè“è“é…±å³å¯ã€‚", p:""}
                ]
            },
            {
                title: "è™¾ä»è¥¿å…°èŠ±æ»‘è›‹", time: "8 min", tags: ["ä½è„‚","æŠ¤çœ¼"],
                img: "https://images.unsplash.com/photo-1627308595229-7830a5c91f9f?auto=format&fit=crop&w=800&q=80", 
                desc: "è™¾ä»å’Œè¥¿å…°èŠ±ç„¯æ°´ï¼Œæ·‹å…¥è›‹æ¶²ç‚’ç†Ÿã€‚",
                ings: [{n:"è™¾ä»",i:""},{n:"è¥¿å…°èŠ±",i:""},{n:"é¸¡è›‹",i:""}],
                steps: [
                    {t:"çƒ§ä¸€é”…æ°´ï¼Œæ°´å¼€åæ”¾å…¥è¥¿å…°èŠ±å’Œè™¾ä»ç„¯æ°´1åˆ†é’Ÿï¼Œæå‡ºæ²¥å¹²ã€‚", p:"ğŸ’¡ æ°´é‡ŒåŠ ç›å’Œæ²¹ï¼Œè¥¿å…°èŠ±æ›´ç¿ ç»¿ã€‚"},
                    {t:"é¸¡è›‹3ä¸ªåŠ ç›æ‰“æ•£ï¼Œå°†ç„¯å¥½æ°´çš„è™¾ä»å’Œè¥¿å…°èŠ±å€’å…¥è›‹æ¶²ä¸­ã€‚", p:""},
                    {t:"å¹³åº•é”…çƒ§çƒ­æ²¹ï¼Œå€’å…¥æ··åˆè›‹æ¶²ï¼Œåº•éƒ¨å‡å›ºåè½»è½»æ¨ç‚’ï¼Œè›‹æ¶²å®Œå…¨å‡å›ºå³å¯å‡ºé”…ã€‚", p:"ğŸ”¥ ä¹Ÿæ˜¯è¦ç«å¤§å¿«ç‚’ï¼Œä¿æŒå«©åº¦ã€‚"}
                ]
            },
            {
                title: "ç‰›æ²¹æœæºå¿ƒè›‹", time: "5 min", tags: ["ä¼˜è´¨æ²¹","è„‘åŠ›"],
                img: "https://images.unsplash.com/photo-1550953831-295058f967f6?auto=format&fit=crop&w=800&q=80",
                desc: "åŠä¸ªç‰›æ²¹æœåˆ‡ç‰‡ï¼Œé…ä¸€ä¸ªç…è›‹ã€‚",
                ings: [{n:"ç‰›æ²¹æœ",i:""},{n:"é¸¡è›‹",i:""}],
                steps: [
                    {t:"å¹³åº•é”…çƒ­æ²¹ï¼Œæ‰“å…¥é¸¡è›‹ï¼Œä¸­å°ç«ç…è‡³è›‹ç™½å‡å›ºã€è›‹é»„å¾®å¾®æ™ƒåŠ¨ï¼ˆå•é¢ç…ï¼‰ã€‚", p:"ğŸ’¡ ç›–ç›–å­ç„–30ç§’ï¼Œæºå¿ƒè›‹æ›´æˆåŠŸã€‚"},
                    {t:"ç‰›æ²¹æœå¯¹åŠåˆ‡å¼€ï¼Œå»æ ¸åˆ‡ç‰‡ã€‚", p:""},
                    {t:"å°†ç…è›‹å’Œç‰›æ²¹æœæ‘†ç›˜ï¼Œæ’’ä¸Šé»‘èƒ¡æ¤’ç²‰å’Œå‡ æ»´é…±æ²¹ã€‚", p:"âœ… ç®€å•çš„é£Ÿæéœ€è¦ä¼˜è´¨è°ƒæ–™æ¿€å‘å‘³é“ã€‚"}
                ]
            },
            {
                title: "ç”Ÿèœé¸¡è‚‰å·", time: "8 min", tags: ["ä¾¿æº","å‡è„‚"],
                img: "https://images.unsplash.com/photo-1626700051175-6818013e1d4f?auto=format&fit=crop&w=800&q=80",
                desc: "å·é¥¼çš®åŠ çƒ­ï¼Œå·å…¥ç”Ÿèœå’Œç†Ÿé¸¡èƒ¸è‚‰ã€‚",
                ings: [{n:"å·é¥¼",i:""},{n:"é¸¡è‚‰",i:""},{n:"ç”Ÿèœ",i:""}],
                steps: [
                    {t:"ä½¿ç”¨å¸‚å”®çš„å³é£Ÿé¸¡èƒ¸è‚‰ï¼ˆåˆ‡æ¡ï¼‰æˆ–è€…å‰æ™šå‰©ä¸‹çš„ç†Ÿé¸¡è‚‰ã€‚", p:"ğŸ’¡ æ—©ä¸Šç°ç…é¸¡è‚‰å¤ªæ…¢ï¼Œå»ºè®®ç”¨æˆå“ã€‚"},
                    {t:"å¹³åº•é”…æ— éœ€æ”¾æ²¹ï¼Œå°†å…¨éº¦å·é¥¼æ”¾å…¥ï¼Œä¸¤é¢å„çƒ™20ç§’å˜è½¯ã€‚", p:""},
                    {t:"é¥¼ä¸Šåˆ·ç‚¹ç•ªèŒ„é…±æˆ–ç”œé¢é…±ï¼Œé“ºä¸Šæ´—å‡€çš„ç”Ÿèœå’Œé¸¡è‚‰æ¡ï¼Œå·ç´§å³å¯ã€‚", p:"âš ï¸ å·ç´§ç‚¹ï¼Œåƒçš„æ—¶å€™ä¸æ¼ã€‚"}
                ]
            },
            // --- è¡¥å……èœè°± (ä»¥ä¸‹æ˜¯æ•…æ„è®¾ç½®çš„åé“¾æ¥ï¼Œç”¨äºæµ‹è¯•æ·±è‰²æ›¿è¡¥å›¾æ•ˆæœ) ---
            { 
                title: "é…¸å¥¶æ°´æœç¢—", time: "3 min", tags: ["ç»´C"], 
                img: "INVALID_URL_TEST", 
                desc:"é…¸å¥¶æ‹Œæ°´æœã€‚", ings:[{n:"é…¸å¥¶",i:""},{n:"æ°´æœ",i:""}],
                steps: [{t:"æ°´æœï¼ˆé¦™è•‰ã€è“è“ã€è‰è“ç­‰ï¼‰æ´—å‡€åˆ‡å—ã€‚",p:""},{t:"å€’å…¥æµ“ç¨ é…¸å¥¶ã€‚",p:""},{t:"æ’’ä¸Šåšæœç¢æ‹ŒåŒ€ã€‚",p:""}]
            },
            { 
                title: "ç…®çº¢è–¯é¸¡è›‹", time: "10 min", tags: ["æç®€"], 
                img: "INVALID_URL_TEST_2", 
                desc:"ä¸€é”…è’¸ç†Ÿã€‚", ings:[{n:"çº¢è–¯",i:""},{n:"é¸¡è›‹",i:""}],
                steps: [{t:"çº¢è–¯æ´—å‡€åˆ‡æˆå°å—ï¼ˆåˆ‡å°ç†Ÿå¾—å¿«ï¼‰ã€‚",p:""},{t:"å’Œé¸¡è›‹ä¸€èµ·å†·æ°´ä¸‹é”…ç…®æˆ–è’¸ã€‚",p:""},{t:"æ°´å¼€åç…®10-12åˆ†é’Ÿå³å¯ã€‚",p:""}]
            }
        ];

        // ç»Ÿä¸€é£Ÿæå›¾ (å…œåº•)
        DB.forEach(r => {
            r.ings.forEach(i => { if(!i.i) i.i = COMMON_ING_IMG; });
        });

        // --- åˆå§‹åŒ–æ—¥æœŸ ---
        const now = new Date();
        const days = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
        document.getElementById('dateStr').innerText = `${now.getMonth()+1}.${now.getDate()} å‘¨${days[now.getDay()]}`;
        
        const start = new Date(now.getFullYear(), 0, 0);
        const dayOfYear = Math.floor((now - start) / 1000 / 60 / 60 / 24);
        const cycle = (dayOfYear % 10) + 1;
        document.getElementById('cycleNum').innerText = cycle;

        // --- æ¸²æŸ“é€»è¾‘ (å¢åŠ äº† onerror å¤„ç†ï¼ŒæŒ‡å‘æ·±è‰²èƒŒæ™¯å›¾) ---
        const homeList = document.getElementById('homeList');
        const todayIdx = [0, 1, 2]; 

        todayIdx.forEach(idx => {
            const r = DB[idx];
            homeList.innerHTML += `
                <div class="recipe-card-large" onclick="openRecipe(${idx})">
                    <div class="time-badge">${r.time}</div>
                    <img src="${r.img}" class="recipe-img-large" onerror="this.src='${DARK_PLACEHOLDER_IMG}'">
                    <div class="recipe-info">
                        <div class="recipe-name">${r.title}</div>
                        <div style="font-size:0.9rem; color:#ccc;">${r.desc}</div>
                        <div class="recipe-tags">
                            ${r.tags.map(t=>`<span class="tag">${t}</span>`).join('')}
                        </div>
                    </div>
                </div>`;
        });

        const moreList = document.getElementById('moreList');
        DB.forEach((r, idx) => {
            moreList.innerHTML += `
                <div class="grid-card" onclick="openRecipe(${idx})">
                    <img src="${r.img}" onerror="this.src='${DARK_PLACEHOLDER_IMG}'">
                    <div class="info">
                        <div class="title">${r.title}</div>
                        <div style="font-size:0.8rem; color:var(--accent-green); margin-top:5px;">${r.time}</div>
                    </div>
                </div>`;
        });

        // --- äº¤äº’é€»è¾‘ ---
        function goPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
            document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active'));
            if(id.includes('home')) document.getElementById('nav-home').classList.add('active');
            if(id.includes('more')) document.getElementById('nav-more').classList.add('active');
            if(id.includes('rank')) document.getElementById('nav-rank').classList.add('active');
        }

        function openRecipe(idx) {
            const r = DB[idx];
            const html = `
                <img src="${r.img}" style="width:100%; height:260px; object-fit:cover; background-color:var(--card-dark);" onerror="this.src='${DARK_PLACEHOLDER_IMG}'">
                <div style="padding:20px;">
                    <h2 style="color:#235347; margin-top:0;">${r.title}</h2>
                    <p style="background:rgba(142,182,155,0.2); padding:10px; border-radius:8px;">${r.desc}</p>
                    
                    <h4 style="border-left:4px solid #235347; padding-left:10px;">æ‰€éœ€é£Ÿæ</h4>
                    <div class="ing-grid">
                        ${r.ings.map(i => `
                            <div class="ing-item">
                                <img src="${i.i}" class="ing-img" onerror="this.src='${COMMON_ING_IMG}'">
                                <div style="font-size:0.8rem; margin-top:5px;">${i.n}</div>
                            </div>`).join('')}
                    </div>

                    <h4 style="border-left:4px solid #235347; padding-left:10px; margin-top:20px;">ä¿å§†çº§åšæ³•</h4>
                    <div style="margin-top:10px;">
                        ${r.steps.map((s, i) => `
                            <div class="step-item">
                                <div class="step-num">${i+1}.</div>
                                <div>
                                    <div class="step-text">${s.t}</div>
                                    ${s.p ? `<div class="step-tips">${s.p}</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="height:60px;"></div>
                </div>`;
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('modal').style.display = 'block';
        }
        function closeModal(){ document.getElementById('modal').style.display = 'none'; }

        // --- å¨ç¥æ¦œ ---
        let curRole = null;
        let users = JSON.parse(localStorage.getItem('bf_users')) || [
            {id:'mom', n:'å¦ˆå¦ˆ', s:5, h:[]},
            {id:'dad', n:'çˆ¸çˆ¸', s:2, h:[]},
            {id:'kid', n:'å¥å®', s:3, h:[]}
        ];

        function renderRank() {
            const list = document.getElementById('rankList');
            list.innerHTML = '';
            users.sort((a,b)=>b.s - a.s).forEach((u, i) => {
                let hHtml = u.h.length ? `<div class="history-grid">${u.h.map(src=>`<img src="${src}" class="history-img" onerror="this.src='${DARK_PLACEHOLDER_IMG}'">`).join('')}</div>` : '<div style="color:#666; font-size:0.8rem; text-align:center;">æš‚æ— è®°å½•</div>';
                list.innerHTML += `
                    <div style="background:rgba(255,255,255,0.05); border-radius:12px; margin-bottom:10px; overflow:hidden;">
                        <div class="rank-item" onclick="toggleHist(this)">
                            <div class="rank-icon-box" style="background:${i==0?'var(--accent-gold)':'var(--card-mid)'}; color:${i==0?'#051F20':'#fff'}">${i+1}</div>
                            <div style="flex:1; color:white;">
                                <div style="font-weight:bold;">${u.n} ${i==0?'ğŸ‘‘':''}</div>
                                <div style="font-size:0.8rem; color:var(--accent-green);">ç§¯åˆ†: ${u.s}</div>
                            </div>
                            <i class="fas fa-chevron-down" style="color:#666;"></i>
                        </div>
                        <div class="history-panel">${hHtml}</div>
                    </div>`;
            });
        }

        function setRole(id) {
            curRole = id;
            document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('r-'+id).classList.add('selected');
            const u = users.find(u=>u.id==id);
            const btn = document.getElementById('upBtn');
            // é€‰ä¸­åæ›´æ–°æŒ‰é’®æ–‡å­—å’Œé¢œè‰²
            btn.innerHTML = `<i class="fas fa-camera"></i> ${u.n}åšå¥½å•¦ï¼ç‚¹å‡»ä¸Šä¼ `;
            btn.style.background = 'var(--accent-gold)';
            btn.style.color = '#051F20';
        }
        
        function clkUpload(){ 
            if(!curRole) {
                alert("è¯·å…ˆç‚¹å‡»ä¸Šæ–¹åœ†å½¢å¤´åƒé€‰æ‹©è§’è‰²ï¼");
                return; 
            }
            document.getElementById('upFile').click(); 
        }
        
        function doUpload(el) {
            if(el.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    const u = users.find(u=>u.id==curRole);
                    u.s++; u.h.unshift(e.target.result);
                    localStorage.setItem('bf_users', JSON.stringify(users));
                    alert('ä¸Šä¼ æˆåŠŸï¼ç§¯åˆ†+1');
                    renderRank();
                };
                reader.readAsDataURL(el.files[0]);
            }
        }
        function toggleHist(el) {
            const p = el.nextElementSibling;
            p.style.display = p.style.display==='block'?'none':'block';
        }

        renderRank();
    </script>
</body>
</html>
