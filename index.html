<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™¨æ›¦é£Ÿå…‰ - å¥å®çš„å…ƒæ°”æ—©é¤</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- æ ¸å¿ƒé…è‰² (Morandi Green) --- */
        :root {
            --bg-deep: #051F20;
            --bg-main: #0B2B26;
            --card-dark: #163832;
            --card-mid: #235347;
            --accent-green: #8EB69B;
            --accent-gold: #E09F3E;
            --text-light: #DAF1DE;
            --text-white: #FFFFFF;
            --shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, var(--bg-deep) 0%, var(--bg-main) 100%);
            color: var(--text-light);
            margin: 0; padding: 0; min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px; /* åº•éƒ¨ç•™ç™½ */
        }

        /* --- é¡µé¢åˆ‡æ¢æ§åˆ¶ --- */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 1. é¡¶éƒ¨åŠ å¼ºç‰ˆ (Header) --- */
        .header-container {
            background: var(--card-dark);
            padding: 20px;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            text-align: center;
        }
        .weather-bar {
            font-size: 0.85rem;
            color: var(--accent-green);
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-flex;
        }
        .date-main { font-size: 1.1rem; color: #fff; font-weight: bold; margin-bottom: 5px; }
        .greeting { font-size: 1.5rem; font-weight: bold; color: var(--text-white); margin: 10px 0; }
        .cycle-tip { font-size: 0.9rem; color: #aaa; }

        /* --- 2. é€šç”¨ç»„ä»¶ --- */
        .section-title {
            padding: 25px 20px 15px; font-size: 1.1rem; font-weight: bold; display: flex; align-items: center; color: var(--text-white);
        }
        .section-title::before {
            content: ''; display: block; width: 5px; height: 18px; background: var(--accent-green); margin-right: 12px; border-radius: 3px;
        }

        .sub-header {
            background: var(--card-dark); padding: 15px 20px; display: flex; align-items: center; 
            justify-content: space-between; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .nav-btn {
            background: rgba(255,255,255,0.1); border: none; color: var(--text-white); padding: 8px 15px;
            border-radius: 20px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 5px;
        }

        /* --- 3. é£Ÿè°±å¡ç‰‡ (çºµå‘ & ç½‘æ ¼) --- */
        .recipe-list-vertical { display: flex; flex-direction: column; gap: 25px; padding: 0 20px; }
        .recipe-card-large {
            background: var(--card-mid); border-radius: 24px; overflow: hidden; box-shadow: var(--shadow);
            position: relative; transition: transform 0.2s;
        }
        .recipe-card-large:active { transform: scale(0.98); }
        .recipe-img-large { height: 200px; width: 100%; object-fit: cover; background-color: #333; }
        .recipe-info { padding: 20px; }
        .recipe-name { font-size: 1.2rem; font-weight: bold; color: var(--text-white); margin-bottom: 8px; }
        .recipe-tags { display: flex; gap: 8px; margin-top: 8px; }
        .tag { font-size: 0.75rem; padding: 3px 8px; border-radius: 6px; background: rgba(0,0,0,0.3); color: var(--accent-green); }
        
        .time-badge {
            position: absolute; top: 15px; right: 15px; background: var(--accent-green); color: #051F20;
            padding: 5px 12px; border-radius: 12px; font-weight: bold; font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .recipe-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .grid-card { background: var(--card-mid); border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; height: 100%; }
        .grid-card img { width: 100%; height: 120px; object-fit: cover; }
        .grid-card .info { padding: 10px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .grid-card .title { font-size: 0.9rem; font-weight: bold; color: var(--text-white); line-height: 1.3; }

        /* --- 4. å¨ç¥æ¦œ (é€»è¾‘å‡çº§) --- */
        .leaderboard { margin: 20px; background: var(--card-dark); border-radius: 24px; padding: 20px; }
        
        /* è§’è‰²é€‰æ‹©å™¨ */
        .role-selector {
            display: flex; justify-content: center; gap: 20px; margin-bottom: 25px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px;
        }
        .role-btn {
            width: 60px; height: 60px; border-radius: 50%; background: #333; border: 3px solid transparent;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #fff;
            transition: all 0.3s; opacity: 0.6; cursor: pointer; position: relative;
        }
        .role-btn.selected { border-color: var(--accent-gold); transform: scale(1.1); opacity: 1; background: var(--card-mid); }
        .role-btn.selected::after { content: 'æˆ‘'; position: absolute; bottom: -20px; font-size: 0.8rem; color: var(--accent-gold); }
        
        /* æ’è¡Œåˆ—è¡¨ */
        .rank-item-wrapper { margin-bottom: 15px; background: rgba(255,255,255,0.05); border-radius: 15px; overflow: hidden; }
        .rank-item { display: flex; align-items: center; padding: 15px; cursor: pointer; }
        .rank-avatar { width: 45px; height: 45px; border-radius: 50%; background: var(--accent-green); display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--bg-deep); margin-right: 15px; }
        .rank-arrow { margin-left: auto; color: #666; transition: transform 0.3s; }
        .rank-item.open .rank-arrow { transform: rotate(180deg); color: var(--accent-green); }

        /* å†å²è®°å½•æŠ˜å é¢æ¿ */
        .history-panel { display: none; background: rgba(0,0,0,0.2); padding: 15px; }
        .history-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .history-img { width: 100%; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); }

        /* ä¸Šä¼ æŒ‰é’® */
        .upload-section { margin-top: 20px; text-align: center; }
        .upload-btn {
            width: 100%; padding: 15px; background: #555; color: #aaa; border: none; border-radius: 16px;
            font-weight: bold; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px;
            pointer-events: none; transition: all 0.3s;
        }
        .upload-btn.active { background: var(--accent-gold); color: #051F20; pointer-events: auto; box-shadow: 0 5px 15px rgba(224, 159, 62, 0.4); }

        /* --- 5. è¯¦æƒ…å¼¹çª— --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; overflow-y: auto; }
        .modal-content { background: #F4F1EA; color: #333; margin: 15px; border-radius: 20px; min-height: 85vh; padding-bottom: 40px; }
        .ingredients-box { background: #fff; margin: 15px; padding: 15px; border-radius: 12px; }
        .ing-grid { display: flex; gap: 15px; overflow-x: auto; }
        .ing-item { text-align: center; min-width: 60px; }
        .ing-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; }
        
        /* åº•éƒ¨å¯¼èˆªæ  (Home Actions) */
        .bottom-dock {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(22, 56, 50, 0.9); backdrop-filter: blur(10px);
            padding: 10px 30px; border-radius: 40px; display: flex; gap: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 900; border: 1px solid rgba(255,255,255,0.1);
        }
        .dock-btn { text-align: center; color: #888; font-size: 0.8rem; cursor: pointer; }
        .dock-btn i { font-size: 1.5rem; display: block; margin-bottom: 3px; }
        .dock-btn.active { color: var(--accent-green); }

    </style>
</head>
<body>

    <div id="page-home" class="page active">
        <div class="header-container">
            <div class="weather-bar">
                <span id="weatherText">ğŸŒ¥ï¸ å¤šäº‘ 5~12Â°C</span>
                <span>|</span>
                <span id="lunarText">å†œå†è®¡ç®—ä¸­...</span>
                <span>|</span>
                <span id="solarTerm">å¤§é›ª</span>
            </div>
            <div class="date-main" id="gregorianDate">2025.12.11 æ˜ŸæœŸå››</div>
            <div class="greeting">æ—©å®‰ï¼Œå¥å®ï¼</div>
            <div class="cycle-tip">âœ¨ 10å¤©ä¸é‡æ ·å¾ªç¯ï¼šç¬¬ <span id="cycleDay" style="color:var(--accent-gold); font-size:1.2em;">1</span> å¤©</div>
        </div>

        <div class="section-title">ä»Šæ—¥æ¨èå…ƒæ°”æ—©é¤ï¼ˆ10åˆ†é’Ÿå¤‡å¦¥ï¼‰</div>
        <div class="recipe-list-vertical" id="homeRecipeList"></div>
        <div style="height: 40px;"></div> </div>

    <div id="page-more" class="page">
        <div class="sub-header">
            <span style="color:white; font-weight:bold; font-size:1.1rem;">30å¤©ç¾å‘³èœè°±åº“</span>
        </div>
        <div class="recipe-grid" id="moreRecipeGrid"></div>
    </div>

    <div id="page-rank" class="page">
        <div class="sub-header">
            <span style="color:white; font-weight:bold; font-size:1.1rem;">å®¶åº­å¨ç¥äº‰éœ¸èµ›</span>
        </div>

        <div class="leaderboard">
            <div style="text-align:center; color:#ccc; margin-bottom:15px; font-size:0.9rem;">ç¬¬1æ­¥ï¼šè¯·å…ˆç‚¹å‡»ä¸‹æ–¹å¤´åƒé€‰æ‹©â€œæˆ‘æ˜¯è°â€</div>
            <div class="role-selector">
                <div class="role-btn" onclick="selectRole('mom')" id="btn-mom">ğŸ‘©</div>
                <div class="role-btn" onclick="selectRole('dad')" id="btn-dad">ğŸ‘¨</div>
                <div class="role-btn" onclick="selectRole('kid')" id="btn-kid">ğŸ‘¦</div>
            </div>

            <div id="rankingList"></div>

            <div class="upload-section">
                <input type="file" id="uploadInput" accept="image/*" style="display: none;" onchange="handleUpload(this)">
                <button id="mainUploadBtn" class="upload-btn" onclick="triggerUpload()">
                    <i class="fas fa-camera"></i> è¯·å…ˆé€‰æ‹©è§’è‰²
                </button>
            </div>
        </div>
    </div>

    <div class="bottom-dock">
        <div class="dock-btn active" onclick="showPage('page-home')" id="nav-home">
            <i class="fas fa-home"></i>é¦–é¡µ
        </div>
        <div class="dock-btn" onclick="showPage('page-more')" id="nav-more">
            <i class="fas fa-utensils"></i>æ›´å¤šèœè°±
        </div>
        <div class="dock-btn" onclick="showPage('page-rank')" id="nav-rank">
            <i class="fas fa-trophy"></i>å¨ç¥æ¦œ
        </div>
    </div>

    <div id="recipeModal" class="modal">
        <div style="position:absolute; top:20px; left:20px; z-index:1002;">
            <button class="nav-btn" style="background:rgba(0,0,0,0.6);" onclick="closeModal()">
                <i class="fas fa-arrow-left"></i> å…³é—­
            </button>
        </div>
        <div class="modal-content" id="modalContent"></div>
    </div>

    <script>
        // ================= 1. ä¿®å¤åçš„å›¾ç‰‡æ•°æ®åº“ (30é“å‡†ç¡®é…å›¾) =================
        // æ‰€æœ‰å›¾ç‰‡å‡æ›¿æ¢ä¸º Unsplash ç²¾é€‰çœŸå®ç¾é£Ÿå›¾
        const RECIPE_DB = [
            // --- Day 1 ---
            { title: "åšæœç‰›å¥¶ç‡•éº¦ç²¥", time: "5 min", tags: ["è¡¥è„‘"], img: "https://images.unsplash.com/photo-1517601278517-456741619dad?w=600&q=80", desc: "ç»å…¸è¡¥è„‘æ—©é¤ï¼Œç‰›å¥¶æ¸©çƒ­å³å¯ã€‚", ingredients: [{name:"ç‡•éº¦",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "æ»‘è›‹ç‰›è‚‰å…¨éº¦å·", time: "8 min", tags: ["é•¿é«˜"], img: "https://images.unsplash.com/photo-1626132647523-66f5bf380027?w=600&q=80", desc: "ç‰›è‚‰è¡¥é“ï¼Œå…¨éº¦æŠ—é¥¿ã€‚", ingredients: [{name:"å…¨éº¦é¥¼",img:""},{name:"ç‰›è‚‰",img:""}] },
            { title: "è™¾ä»è¥¿å…°èŠ±çƒ˜è›‹", time: "10 min", tags: ["æŠ¤çœ¼"], img: "https://images.unsplash.com/photo-1504185945330-dd403063204b?w=600&q=80", desc: "è‰²å½©ä¸°å¯Œï¼Œä½è„‚é«˜è›‹ç™½ã€‚", ingredients: [{name:"è™¾ä»",img:""},{name:"è¥¿å…°èŠ±",img:""}] },
            
            // --- Day 2 ---
            { title: "é‡‘æªé±¼ç‰ç±³ä¸‰æ˜æ²»", time: "5 min", tags: ["ç›Šæ™º"], img: "https://images.unsplash.com/photo-1539252554453-80ab65ce3586?w=600&q=80", desc: "é‡‘æªé±¼å¯Œå«DHAï¼Œæ­é…ç‰ç±³ç²’ã€‚", ingredients: [{name:"åå¸",img:""},{name:"é‡‘æªé±¼",img:""}] },
            { title: "è‘±æ²¹é˜³æ˜¥é¢", time: "8 min", tags: ["æš–èƒƒ"], img: "https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=600&q=80", desc: "ä¸€æŠŠæŒ‚é¢ï¼Œä¸€å‹ºè‘±æ²¹é…±æ²¹ã€‚", ingredients: [{name:"æŒ‚é¢",img:""},{name:"å°è‘±",img:""}] },
            { title: "æ—¥å¼é¥­å›¢", time: "10 min", tags: ["æŠ—é¥¿"], img: "https://images.unsplash.com/photo-1563102325-1a3b37905d49?w=600&q=80", desc: "ç±³é¥­åŒ…æµ·è‹”ï¼Œä¸­é—´å¤¹è‚‰æ¾ã€‚", ingredients: [{name:"ç±³é¥­",img:""},{name:"æµ·è‹”",img:""}] },

            // --- Day 3 ---
            { title: "ç´«è–¯èŠå£«çƒ", time: "10 min", tags: ["ç²—ç²®"], img: "https://images.unsplash.com/photo-1616428751508-3dc462744889?w=600&q=80", desc: "è’¸ç´«è–¯å‹æ³¥åŒ…èŠå£«ç‰‡ã€‚", ingredients: [{name:"ç´«è–¯",img:""},{name:"èŠå£«",img:""}] },
            { title: "ç•ªèŒ„é¸¡è›‹ç–™ç˜©æ±¤", time: "10 min", tags: ["æ˜“æ¶ˆåŒ–"], img: "https://images.unsplash.com/photo-1547592166-23acbe34071b?w=600&q=80", desc: "é¢ç²‰æ…çµ®ï¼Œç•ªèŒ„æ±¤åº•ä¸€ç…®å³æˆã€‚", ingredients: [{name:"é¢ç²‰",img:""},{name:"ç•ªèŒ„",img:""}] },
            { title: "èŠ±ç”Ÿé…±é¦™è•‰åå¸", time: "3 min", tags: ["å¿«æ‰‹"], img: "https://images.unsplash.com/photo-1550614000-4b9519e07d72?w=600&q=80", desc: "æ— éœ€å¼€ç«ï¼ŒæŠ¹é…±åˆ‡é¦™è•‰ã€‚", ingredients: [{name:"åå¸",img:""},{name:"é¦™è•‰",img:""}] },

            // --- Day 4 ---
            { title: "é²œè‚‰å°é¦„é¥¨", time: "8 min", tags: ["æ±¤æ°´"], img: "https://images.unsplash.com/photo-1596797038530-2c107229654b?w=600&q=80", desc: "å†°ç®±å¸¸å¤‡é€Ÿå†»å°é¦„é¥¨ã€‚", ingredients: [{name:"é¦„é¥¨",img:""},{name:"ç´«èœ",img:""}] },
            { title: "ç‰›æ²¹æœæºå¿ƒè›‹", time: "6 min", tags: ["è„‘åŠ›"], img: "https://images.unsplash.com/photo-1525351484163-7529414395d8?w=600&q=80", desc: "ç‰›æ²¹æœæ­é…ç…è›‹ã€‚", ingredients: [{name:"ç‰›æ²¹æœ",img:""},{name:"é¸¡è›‹",img:""}] },
            { title: "å°ç±³å—ç“œç²¥", time: "0 min", tags: ["å…»èƒƒ"], img: "https://images.unsplash.com/photo-1505253716371-bab3a29d6d09?w=600&q=80", desc: "ç”µé¥­ç…²é¢„çº¦ï¼Œæ—©ä¸Šç›´æ¥åƒã€‚", ingredients: [{name:"å°ç±³",img:""},{name:"å—ç“œ",img:""}] },

            // --- Day 5 ---
            { title: "é¸¡èƒ¸è‚‰æ²™æ‹‰", time: "8 min", tags: ["å‡è„‚"], img: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=600&q=80", desc: "ç…ç†Ÿé¸¡èƒ¸è‚‰æ‹Œç”Ÿèœã€‚", ingredients: [{name:"é¸¡èƒ¸",img:""},{name:"ç”Ÿèœ",img:""}] },
            { title: "çº¢ç³–å‘ç³•", time: "10 min", tags: ["èƒ½é‡"], img: "https://images.unsplash.com/photo-1621655065166-73138356947c?w=600&q=80", desc: "åŠæˆå“å‘ç³•è’¸10åˆ†é’Ÿã€‚", ingredients: [{name:"å‘ç³•",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "é…¸å¥¶æ°´æœæ", time: "3 min", tags: ["ç»´C"], img: "https://images.unsplash.com/photo-1488477181946-6428a0291777?w=600&q=80", desc: "é…¸å¥¶åŠ åšæœç¢å’Œæ°´æœã€‚", ingredients: [{name:"é…¸å¥¶",img:""},{name:"è“è“",img:""}] },

            // --- Day 6 ---
            { title: "åŸ¹æ ¹æ‰‹æŠ“é¥¼", time: "5 min", tags: ["è§£é¦‹"], img: "https://images.unsplash.com/photo-1626078299034-297eb040a43e?w=600&q=80", desc: "å†·å†»æ‰‹æŠ“é¥¼ä¸¤é¢ç…é»„ã€‚", ingredients: [{name:"æ‰‹æŠ“é¥¼",img:""},{name:"åŸ¹æ ¹",img:""}] },
            { title: "çº¢è–¯ç…®é¸¡è›‹", time: "10 min", tags: ["æç®€"], img: "https://images.unsplash.com/photo-1594970420448-6932a93361e6?w=600&q=80", desc: "ä¸€é”…è’¸ç†Ÿï¼Œå¥åº·æ— æ²¹çƒŸã€‚", ingredients: [{name:"çº¢è–¯",img:""},{name:"é¸¡è›‹",img:""}] },
            { title: "è‚‰æ¾ä¸‰æ˜æ²»", time: "5 min", tags: ["å’¸é¦™"], img: "https://images.unsplash.com/photo-1484723091739-30a097e8f929?w=600&q=80", desc: "åå¸å¤¹è‚‰æ¾å’Œæ²™æ‹‰é…±ã€‚", ingredients: [{name:"è‚‰æ¾",img:""},{name:"åå¸",img:""}] },

            // --- Day 7 ---
            { title: "é»„é‡‘é¦’å¤´ç‰‡", time: "5 min", tags: ["å‰©é¥­"], img: "https://images.unsplash.com/photo-1626202166699-b1d5c7075b14?w=600&q=80", desc: "å‰©é¦’å¤´è£¹è›‹æ¶²ç…è‡³é‡‘é»„ã€‚", ingredients: [{name:"é¦’å¤´",img:""},{name:"é¸¡è›‹",img:""}] },
            { title: "ç‰›å¥¶ç‰ç±³ç‰‡", time: "2 min", tags: ["æé€Ÿ"], img: "https://images.unsplash.com/photo-1520025642999-566275e5262c?w=600&q=80", desc: "å³é£Ÿç‰ç±³ç‰‡å†²ç‰›å¥¶ã€‚", ingredients: [{name:"ç‰ç±³ç‰‡",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "è›‹ç‚’é¥­", time: "8 min", tags: ["ç®¡é¥±"], img: "https://images.unsplash.com/photo-1603133872878-684f208fb84b?w=600&q=80", desc: "å‰©ç±³é¥­åŠ ç«è…¿é¸¡è›‹å¿«ç‚’ã€‚", ingredients: [{name:"ç±³é¥­",img:""},{name:"ç«è…¿",img:""}] },

            // --- Day 8 ---
            { title: "é¸¡è‚‰å·", time: "8 min", tags: ["ä¾¿æº"], img: "https://images.unsplash.com/photo-1626700051175-6818013e1d4f?w=600&q=80", desc: "å·é¥¼å¤¹é¸¡æŸ³å’Œç”Ÿèœã€‚", ingredients: [{name:"å·é¥¼",img:""},{name:"é¸¡æŸ³",img:""}] },
            { title: "å‘³å™Œæ±¤æ³¡é¥­", time: "5 min", tags: ["æš–èº«"], img: "https://images.unsplash.com/photo-1547592180-85f173990554?w=600&q=80", desc: "é€Ÿé£Ÿå‘³å™Œæ±¤å†²æ³¡ç±³é¥­ã€‚", ingredients: [{name:"å‘³å™Œ",img:""},{name:"ç±³é¥­",img:""}] },
            { title: "è“è“å±±è¯æ³¥", time: "10 min", tags: ["å¥è„¾"], img: "https://images.unsplash.com/photo-1567529684892-09290a1b2d05?w=600&q=80", desc: "å±±è¯è’¸ç†Ÿå‹æ³¥æ·‹è“è“é…±ã€‚", ingredients: [{name:"å±±è¯",img:""},{name:"è“è“é…±",img:""}] },

            // --- Day 9 ---
            { title: "åå¸æŠ«è¨", time: "10 min", tags: ["è¶£å‘³"], img: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=600&q=80", desc: "åå¸æ”¾é¦™è‚ èŠå£«ç…åŒ–ã€‚", ingredients: [{name:"åå¸",img:""},{name:"èŠå£«ç¢",img:""}] },
            { title: "é»‘èŠéº»ç³Š", time: "3 min", tags: ["ä¹Œå‘"], img: "https://images.unsplash.com/photo-1599321955726-e04842d6c2e7?w=600&q=80", desc: "é»‘èŠéº»ç²‰å†²çƒ­ç‰›å¥¶ã€‚", ingredients: [{name:"èŠéº»ç²‰",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "è¥¿è‘«èŠ¦å¡Œç³Š", time: "10 min", tags: ["è½¯å«©"], img: "https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=600&q=80", desc: "è¥¿è‘«èŠ¦ä¸æ‹Œé¢ç³Šç…é¥¼ã€‚", ingredients: [{name:"è¥¿è‘«èŠ¦",img:""},{name:"é¢ç²‰",img:""}] },

            // --- Day 10 ---
            { title: "å¹¿å¼è‚ ç²‰", time: "8 min", tags: ["æ¸…æ·¡"], img: "https://images.unsplash.com/photo-1555126634-323283e090fa?w=600&q=80", desc: "è¶Šå—æ˜¥å·çš®è’¸è›‹æ¨¡æ‹Ÿè‚ ç²‰ã€‚", ingredients: [{name:"æ˜¥å·çš®",img:""},{name:"é¸¡è›‹",img:""}] },
            { title: "æ³•å¼åå¸", time: "8 min", tags: ["é¦™ç”œ"], img: "https://images.unsplash.com/photo-1484723091739-30a097e8f929?w=600&q=80", desc: "åå¸æµ¸è›‹æ¶²ç…é»„ã€‚", ingredients: [{name:"åå¸",img:""},{name:"ç‰›å¥¶",img:""}] },
            { title: "è‘±æ²¹æ‹Œé¢", time: "8 min", tags: ["é²œç¾"], img: "https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=600&q=80", desc: "é¢æ¡ç…®ç†Ÿæ‹Œè‘±æ²¹æ±ã€‚", ingredients: [{name:"é¢æ¡",img:""},{name:"è‘±æ²¹",img:""}] }
        ];

        // è‡ªåŠ¨è¡¥å……å ä½æ•°æ®
        RECIPE_DB.forEach(r => {
            if(!r.steps) r.steps = [
                {text:"1. å‡†å¤‡é£Ÿæã€‚",note:""}, 
                {text:"2. ç®€å•çƒ¹é¥ªã€‚",note:""}, 
                {text:"3. è£…ç›˜äº«ç”¨ã€‚",note:""}
            ];
            r.ingredients.forEach(i => { if(!i.img) i.img = "https://images.unsplash.com/photo-1606914469725-e39c34bfdebe?w=100&q=80"; });
        });

        // ================= 2. é¡µé¢åˆå§‹åŒ–é€»è¾‘ =================
        function initHeader() {
            const now = new Date();
            // 1. å…¬å†
            const weekDays = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
            document.getElementById('gregorianDate').innerText = 
                `${now.getFullYear()}.${now.getMonth()+1}.${now.getDate()} æ˜ŸæœŸ${weekDays[now.getDay()]}`;
            
            // 2. å†œå† & èŠ‚æ°” (æ¨¡æ‹Ÿç®—æ³•ï¼Œç®€åŒ–å¤„ç†)
            // çœŸå®é¡¹ç›®ä¸­å»ºè®®å¼•ç”¨ 'lunar-javascript' åº“
            // è¿™é‡Œä¸ºäº†ä»£ç ç®€æ´ï¼Œæ ¹æ®æ—¥æœŸæ®µåšç®€å•åˆ¤æ–­æ¼”ç¤º
            const day = now.getDate();
            let lunarStr = "å†œå†åä¸€æœˆ";
            let termStr = "å¤§é›ª"; 
            if(day > 21) termStr = "å†¬è‡³";
            if(day < 10) lunarStr += "åˆ" + ["ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹"][day-1];
            else if(day < 20) lunarStr += "å" + ["","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹"][day-10];
            else lunarStr += "å»¿" + ["","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹"][day-20];
            
            document.getElementById('lunarText').innerText = lunarStr;
            document.getElementById('solarTerm').innerText = termStr;
            
            // 3. è®¡ç®—ç¬¬å‡ å¤©
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            const cycleDay = (dayOfYear % 10) + 1;
            document.getElementById('cycleDay').innerText = cycleDay;

            return dayOfYear;
        }

        const dayOfYear = initHeader();

        // æ¸²æŸ“é¦–é¡µ (æ¯æ—¥3ä¸ª)
        const homeList = document.getElementById('homeRecipeList');
        const startIdx = (dayOfYear * 3) % RECIPE_DB.length;
        [0,1,2].forEach((offset, i) => {
            const idx = (startIdx + offset) % RECIPE_DB.length;
            const r = RECIPE_DB[idx];
            homeList.innerHTML += `
                <div class="recipe-card-large" onclick="openRecipe(${idx})">
                    <div class="time-badge">${r.time}</div>
                    <img src="${r.img}" class="recipe-img-large">
                    <div class="recipe-info">
                        <div class="recipe-name">${r.title}</div>
                        <div style="font-size:0.9rem; color:#ccc;">${r.desc}</div>
                        <div class="recipe-tags">
                            ${r.tags.map(t=>`<span class="tag">${t}</span>`).join('')}
                        </div>
                    </div>
                </div>`;
        });

        // æ¸²æŸ“æ›´å¤šèœè°± (å…¨éƒ¨)
        const moreList = document.getElementById('moreRecipeGrid');
        RECIPE_DB.forEach((r, idx) => {
            moreList.innerHTML += `
                <div class="grid-card" onclick="openRecipe(${idx})">
                    <img src="${r.img}">
                    <div class="info">
                        <div class="title">${r.title}</div>
                        <div style="font-size:0.8rem; color:var(--accent-green); margin-top:5px;">${r.time}</div>
                    </div>
                </div>`;
        });

        // ================= 3. å¨ç¥æ¦œ & ä¸Šä¼ é€»è¾‘ (æ ¸å¿ƒä¿®æ”¹) =================
        let currentUserRole = null;
        
        // æ¨¡æ‹Ÿæ•°æ®åº“ (ä»æœ¬åœ°å­˜å‚¨è¯»å–)
        let users = JSON.parse(localStorage.getItem('breakfastUsers')) || [
            { id: 'mom', name: "å¦ˆå¦ˆ", avatar: "ğŸ‘©", score: 5, history: [] }, 
            { id: 'dad', name: "çˆ¸çˆ¸", avatar: "ğŸ‘¨", score: 2, history: [] }, 
            { id: 'kid', name: "å¥å®", avatar: "ğŸ‘¦", score: 3, history: [] }
        ];

        function renderRank() {
            // æ’åº
            const sortedUsers = [...users].sort((a,b) => b.score - a.score);
            const list = document.getElementById('rankingList');
            list.innerHTML = '';

            sortedUsers.forEach((u, idx) => {
                // ç”Ÿæˆå†å²å›¾ç‰‡HTML
                let historyHtml = '';
                if(u.history.length > 0) {
                    historyHtml = '<div class="history-grid">' + 
                        u.history.map(img => `<img src="${img}" class="history-img">`).join('') + 
                        '</div>';
                } else {
                    historyHtml = '<div style="text-align:center; color:#666; font-size:0.8rem;">æš‚æ— æ‰“å¡è®°å½•</div>';
                }

                const html = `
                    <div class="rank-item-wrapper">
                        <div class="rank-item" onclick="toggleHistory(this)">
                            <div class="rank-avatar">${u.avatar}</div>
                            <div style="flex:1;">
                                <div style="font-weight:bold; color:white;">${u.name} ${idx===0?'ğŸ‘‘':''}</div>
                                <div style="font-size:0.8rem; color:var(--accent-green);">ç´¯è®¡åšé¥­: ${u.score} æ¬¡</div>
                            </div>
                            <div class="rank-arrow"><i class="fas fa-chevron-down"></i></div>
                        </div>
                        <div class="history-panel">
                            <div style="margin-bottom:10px; font-size:0.8rem; color:#aaa;">ğŸ“¸ å†å²æ‰“å¡ç›¸å†Œï¼š</div>
                            ${historyHtml}
                        </div>
                    </div>
                `;
                list.innerHTML += html;
            });
        }

        // é€‰æ‹©è§’è‰²
        function selectRole(roleId) {
            currentUserRole = roleId;
            // UI æ›´æ–°
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('btn-'+roleId).classList.add('selected');
            
            const btn = document.getElementById('mainUploadBtn');
            const u = users.find(u=>u.id===roleId);
            btn.innerHTML = `<i class="fas fa-camera"></i> ${u.name}åšå¥½å•¦ï¼ç‚¹å‡»ä¸Šä¼ `;
            btn.classList.add('active');
        }

        // è§¦å‘ä¸Šä¼ 
        function triggerUpload() {
            if(!currentUserRole) return;
            document.getElementById('uploadInput').click();
        }

        // å¤„ç†æ–‡ä»¶
        function handleUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgData = e.target.result; // Base64å›¾ç‰‡
                    
                    // æ›´æ–°æ•°æ®
                    const u = users.find(u => u.id === currentUserRole);
                    u.score += 1;
                    u.history.unshift(imgData); // åŠ åˆ°æœ€å‰é¢
                    
                    // ä¿å­˜åˆ°æœ¬åœ°
                    localStorage.setItem('breakfastUsers', JSON.stringify(users));
                    
                    alert(`âœ… æ‰“å¡æˆåŠŸï¼${u.name}çš„å¨è‰ºå€¼+1\nï¼ˆç…§ç‰‡å·²ä¿å­˜åˆ°å†å²è®°å½•ï¼‰`);
                    renderRank();
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // å±•å¼€/æ”¶èµ·å†å²
        function toggleHistory(el) {
            el.classList.toggle('open');
            const panel = el.nextElementSibling;
            if (panel.style.display === "block") {
                panel.style.display = "none";
            } else {
                panel.style.display = "block";
            }
        }

        renderRank(); // åˆå§‹åŒ–æ’è¡Œæ¦œ

        // ================= 4. è¯¦æƒ…é¡µ & å¯¼èˆª =================
        function openRecipe(index) {
            const r = RECIPE_DB[index];
            const html = `
                <img src="${r.img}" style="width:100%; height:260px; object-fit:cover;">
                <div style="padding:20px;">
                    <h2 style="color:#235347; margin-top:0;">${r.title}</h2>
                    <p style="background:rgba(142, 182, 155, 0.2); padding:10px; border-radius:8px;">${r.desc}</p>
                    <h4 style="border-left:4px solid #235347; padding-left:10px;">é£Ÿæ</h4>
                    <div class="ingredients-box">
                        <div class="ing-grid">
                            ${r.ingredients.map(i=>`
                                <div class="ing-item">
                                    <img src="${i.img}" class="ing-img">
                                    <div style="font-size:0.8rem;">${i.name}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <h4 style="border-left:4px solid #235347; padding-left:10px;">åšæ³•</h4>
                    ${r.steps.map(s=>`<div style="padding:10px 0; border-bottom:1px dashed #ccc;">${s.text}</div>`).join('')}
                    <div style="height:50px;"></div>
                </div>
            `;
            document.getElementById('modalContent').innerHTML = html;
            document.getElementById('recipeModal').style.display = 'block';
        }

        function closeModal() { document.getElementById('recipeModal').style.display = 'none'; }
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0,0);
            
            // åº•éƒ¨å¯¼èˆªçŠ¶æ€æ›´æ–°
            document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active'));
            if(pageId === 'page-home') document.getElementById('nav-home').classList.add('active');
            if(pageId === 'page-more') document.getElementById('nav-more').classList.add('active');
            if(pageId === 'page-rank') document.getElementById('nav-rank').classList.add('active');
        }
    </script>
</body>
</html>
